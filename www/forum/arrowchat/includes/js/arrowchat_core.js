!function(a){a.arrowchat=function(){var $body=a("body"),$tooltip=null,$users={},$user_popups={},$chatrooms={},$chatrooms_popups={};function addHover(t,r){t.each(function(t,o){a(o).hover(function(){a(this).addClass(r)},function(){a(this).removeClass(r)})})}function preventScrolling(a){a.bind("mousewheel DOMMouseScroll",function(a){var t=a.originalEvent,r=t.wheelDelta||-t.deltaY||-t.detail;this.scrollTop+=(r<0?1:-1)*30,a.preventDefault()})}function closePopup(a,t,r){void 0!==a&&(1==r?a.addClass("arrowchat_tabopen_hidden"):a.removeClass("arrowchat_tabopen")),void 0!==t&&t.removeClass("arrowchat_tabclick arrowchat_userstabclick arrowchat_trayclick arrowchat_usertabclick")}function hideTooltip(){$tooltip&&$tooltip.hide()}function showTooltip(t,r,o,e,s,n,h){null===$tooltip&&($tooltip=a('<div id="arrowchat_tooltip"><div class="arrowchat_tooltip_content"></div></div>').appendTo($body),$tooltip_content=a(".arrowchat_tooltip_content",$tooltip)),$tooltip_content.html(r);var l=t.offset(),d=t.width(),w=t.height(),m=$tooltip.width();e||(e=0),s||(s=0),o?$tooltip.css({top:l.top-a(window).scrollTop()-w-5-s,left:l.left+d-16-e,display:"block","padding-right":"0px","padding-left":"0px"}).addClass("arrowchat_tooltip_left"):h?$tooltip.css({top:l.top-a(window).scrollTop()+w/2-10-s,left:l.left+d+28-e,display:"block","padding-right":"0px","padding-left":"6px"}).removeClass("arrowchat_tooltip_left"):n?$tooltip.css({top:l.top-a(window).scrollTop()+w/2-10-s,left:l.left+d-m+18-e,display:"block","background-position":m-128+"px -58px","padding-right":"6px","padding-left":"0px"}).removeClass("arrowchat_tooltip_left"):$tooltip.css({top:l.top-a(window).scrollTop()-w-5-s,left:l.left+d-m+18-e,display:"block","padding-right":"0px","padding-left":"0px"}).removeClass("arrowchat_tooltip_left"),W&&($tooltip.css("position","absolute"),$tooltip.css("top",parseInt(a(window).height())-parseInt($tooltip.css("bottom"))-parseInt($tooltip.height())+a(window).scrollTop()+"px"))}function replaceURLWithHTMLLinks(a){return anchorme.js(a)}function youTubeEmbed(a){var t=/^(?:https?:\/\/)?(?:www\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=)?([^\s]+)$/mi,r=a.match(t);return r&&11==r[1].length&&(a='<span style="margin-bottom:5px;display:block">'+r[0]+'</span><div style="margin-bottom:5px"></div><iframe style="width:100%;height:140px" src="https://www.youtube.com/embed/'+r[1]+'" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>'),a}function smileyreplace(a){if(1!=c_disable_smilies){a=a.replace(/^(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|\ud83c[\udffb-\udfff])?)*$/g,function(a,t,r,o){return'<span class="arrowchat_emoji_text arrowchat_emoji_32">'+a+"</span>"});for(var t=0;t<Smiley.length;t++){var r=Smiley[t][1].replace(/</g,"&lt;").replace(/>/g,"&gt;"),o=a.lastIndexOf(r);-1!=o&&(a=a.replace(RegExp(RegExp.escape(r),"g"),'<span class="arrowchat_emoji_text"><img src="'+c_ac_path+"includes/emojis/img/16/"+Smiley[t][0]+'" alt="" /> </span>'))}for(var t=0;t<premade_smiley.length;t++){var r=premade_smiley[t][0].replace(/</g,"&lt;").replace(/>/g,"&gt;"),o=a.lastIndexOf(r);-1!=o&&(a=a==r?a.replace(RegExp(RegExp.escape(r),"g"),premade_smiley[t][1]):a.replace(RegExp(RegExp.escape(" "+r),"g")," "+premade_smiley[t][1]))}}return a}function update_pending_room_status(t,r,o){a(".arrowchat_pending_msg_room_"+r).length>0&&(a(".arrowchat_pending_msg_room_"+r+" .arrowchat_pending_icon").addClass(o),a.isNumeric(t)&&0!=t&&a(".arrowchat_pending_msg_room_"+r).attr("id","arrowchat_chatroom_message_"+t))}function sendChatroomMessage(t,r){var o=t.val();if(o=o.replace(/^\s+|\s+$/g,""),t.val("").css({height:orig_txt_size,"overflow-y":"hidden"}).focus(),1==c_send_room_msg&&""!=o)displayMessage(a(".arrowchat_message_box",$chatrooms_popups[r]),lang[209],"error");else{var e=0;""!=o&&a.ajax({url:c_ac_path+"includes/json/send/send_message_chatroom.php",type:"post",cache:!1,dataType:"json",data:{userid:u_id,username:u_name,chatroomid:r,message:o},beforeSend:function(){addMessageToChatroom(0,u_name,o,0,r,e=++pending_msg_room_count)},error:function(){displayMessage(a(".arrowchat_message_box",$chatrooms_popups[r]),lang[135],"error"),update_pending_room_status(0,e,"arrowchat_pending_error")},success:function(t){if(t){var s=!0;a.isNumeric(t)&&(s=!1);var n=!0;s&&t&&a.each(t,function(o,s){"error"==o&&a.each(s,function(o,s){n=!1,displayMessage(a(".arrowchat_message_box",$chatrooms_popups[r]),s.m,"error"),update_pending_room_status(t,e,"arrowchat_pending_error")})}),n&&(update_pending_room_status(t,e,"arrowchat_pending_delivered"),lsClick(JSON.stringify([t,u_name,o,r]),"send_chatroom_message"))}}})}return!1}function chatroomKeydown(a,t,r){if(13==a.keyCode&&0==a.shiftKey)return sendChatroomMessage(t,r),!1}function update_pending_status(t,r,o){a(".arrowchat_pending_msg_"+r).length>0&&(a(".arrowchat_pending_msg_"+r+" .arrowchat_pending_icon").addClass(o),a.isNumeric(t)&&0!=t&&a(".arrowchat_pending_msg_"+r).attr("id","arrowchat_message_"+t))}function sendUserMessage(t,r){var o=t.val();if(o=o.replace(/^\s+|\s+$/g,""),t.val("").css({height:orig_txt_size,"overflow-y":"hidden"}).focus(),1==c_send_priv_msg&&""!=o)displayMessage(a(".arrowchat_message_box",$user_popups[r]),lang[209],"error");else{var e=0,s=Math.floor((new Date).getTime()/1e3);""!=o&&a.ajax({url:c_ac_path+"includes/json/send/send_message.php",type:"post",cache:!1,dataType:"json",data:{userid:u_id,to:r,message:o},beforeSend:function(){e=++pending_msg_count,clearTimeout(pa),fa=-1,receiveMessage(0,r,o,s,1,0,1,e)},error:function(){displayMessage(a(".arrowchat_message_box",$user_popups[r]),lang[135],"error"),update_pending_status(0,e,"arrowchat_pending_error")},success:function(t){t&&(a.isNumeric(t)?(last_id[r]=t,update_pending_status(t,e,"arrowchat_pending_delivered"),lsClick(JSON.stringify([t,r,o,s,1,1]),"private_message")):a.each(t,function(o,s){"error"==o&&a.each(s,function(o,s){displayMessage(a(".arrowchat_message_box",$user_popups[r]),s.m,"error"),update_pending_status(t,e,"arrowchat_pending_error")})})),K=1}})}}function userchatKeydown(t,r,o){if(clearTimeout(pa),pa=setTimeout(function(){a.post(c_ac_path+"includes/json/send/send_typing.php",{userid:u_id,typing:o,untype:1},function(){}),fa=-1},5e3),fa!=o&&(a.post(c_ac_path+"includes/json/send/send_typing.php",{userid:u_id,typing:o},function(){}),fa=o),13==t.keyCode&&0==t.shiftKey)return sendUserMessage(r,o),!1}function resizeChatfield(a){var t=a[0].clientHeight;t<94?(t=Math.min(94,t=Math.max(a[0].scrollHeight,t)))>a[0].clientHeight&&a.css("height",t+3+"px"):a.css("overflow-y","auto"),a[0].value.length<10&&a.css("height",orig_txt_size)}function chatroomKeyup(t,r,o){a(".arrowchat_smiley_popout",$chatrooms_popups[o]).children(".arrowchat_more_popout").is(":visible")&&a(".arrowchat_smiley_popout",$chatrooms_popups[o]).children(".arrowchat_more_popout").hide(),resizeChatfield(r)}function userchatKeyup(t,r,o){a(".arrowchat_smiley_popout",$user_popups[o]).children(".arrowchat_more_popout").is(":visible")&&a(".arrowchat_smiley_popout",$user_popups[o]).children(".arrowchat_more_popout").hide(),resizeChatfield(r)}function clearUserStatus(){}function setUserStatus(t){a.post(c_ac_path+"includes/json/send/send_status.php",{userid:u_id,status:t},function(){})}function showUserOffline(){w=1,clearUserStatus(),a("#arrowchat_mobiletab").addClass("arrowchat_mobiletab_offline"),$buddy_list_tab.removeClass("arrowchat_tabclick").removeClass("arrowchat_userstabclick"),$userstab_popup.removeClass("arrowchat_tabopen"),setUserStatus("offline"),$open_windows.hide(),$closed_windows.hide()}function buildMaintenance(){($maintenance=a(ArrowChat.Templates.maintenance_tab(c_login_url)).appendTo($base)).mouseover(function(){"1"==c_db_connection?showTooltip(a("#arrowchat_mobiletab_icon"),lang[303],0,0,-15):"1"==c_guests_login_msg&&""==u_id?showTooltip(a("#arrowchat_mobiletab_icon"),lang[58],0,0,-15):showTooltip(a("#arrowchat_mobiletab_icon"),lang[27],0,0,-15)}),$maintenance.mouseout(function(){hideTooltip()})}function startCreateChatRoom(){var t=a(".arrowchat_room_name_input").val(),r=a(".arrowchat_room_password_input").val(),o="",e="";a(".arrowchat_chatroom_full_content").removeClass("arrowchat_chatroom_opacity"),a(".arrowchat_chatroom_list").removeClass("arrowchat_chatroom_clicked"),a(".arrowchat_room_name_input").val(""),a(".arrowchat_room_password_input").val(""),""!=(t=t.replace(/^\s+|\s+$/g,""))&&a.post(c_ac_path+"includes/json/send/send_chatroom_create.php",{userid:u_id,name:t,password:r,description:o,welcome:e},function(t){t&&(a("#arrowchat_create_room_flyout").removeClass("arrowchat_create_room_flyout_display"),a(".arrowchat_room_create").hide(),"-1"==t?displayMessage(a("#arrowchat_chatroom_message_flyout"),lang[39],"error"):"-2"==t?displayMessage(a("#arrowchat_chatroom_message_flyout"),lang[40],"error"):loadChatroomList(t,r))})}function buildChatroomsButton(){1==c_user_chatrooms&&(a("#arrowchat_room_selection").mouseenter(function(){a(".arrowchat_room_create").show()}),a("#arrowchat_room_selection").mouseleave(function(){a("#arrowchat_create_room_flyout").hasClass("arrowchat_create_room_flyout_display")||a(".arrowchat_room_create").hide()}),a(".arrowchat_room_create").mouseenter(function(){showTooltip(a(this),lang[93],0,10,5),a(this).addClass("arrowchat_room_create_hover")}).children().mouseenter(function(){return!1}),a(".arrowchat_room_create").mouseleave(function(){hideTooltip(),a(this).removeClass("arrowchat_room_create_hover")}).children().mouseleave(function(){return!1}),a(".arrowchat_room_create").click(function(){hideTooltip(),a("#arrowchat_create_room_flyout").toggleClass("arrowchat_create_room_flyout_display"),a(this).toggleClass("arrowchat_room_create_selected"),a(".arrowchat_create_input").focus()}).children().click(function(){return!1}),a("body").click(function(t){a(t.target).closest(".arrowchat_room_create").length||a("#arrowchat_create_room_flyout").removeClass("arrowchat_create_room_flyout_display")}),a(".arrowchat_create_password_wrapper").click(function(){a(".arrowchat_password_input_wrapper").show(),a(this).hide(),a(".arrowchat_room_password_input").focus()}),a(".arrowchat_room_name_input").keydown(function(t){13==t.keyCode&&startCreateChatRoom()}),a("#arrowchat_create_room_button").click(function(){startCreateChatRoom()}),a(".arrowchat_room_password_input").placeholder(),a(".arrowchat_room_name_input").placeholder()),a("#arrowchat_room_selection").click(function(){a(this).hasClass("arrowchat_selection_tab_selected")||(lsClick("#arrowchat_room_selection","ac_click"),a(this).addClass("arrowchat_selection_tab_selected"),a("#arrowchat_user_selection",$userstab_popup).removeClass("arrowchat_selection_tab_selected"),count=0,a(".arrowchat_chatroom_full_content").show(),a("#arrowchat_userscontent").hide(),loadChatroomList())}),preventScrolling(a(".arrowchat_chatroom_full_content")),1==a.cookie("arrowchat_no_userlist")&&a(".arrowchat_chatroom_full_content").addClass("arrowchat_no_userlist"),a("#list_button").click(function(){a(".arrowchat_chatroom_full_content").hasClass("arrowchat_no_userlist")?(a.cookie("arrowchat_no_userlist",0,{expires:365,path:"/"}),a(".arrowchat_chatroom_full_content").removeClass("arrowchat_no_userlist")):(a.cookie("arrowchat_no_userlist",1,{expires:365,path:"/"}),a(".arrowchat_chatroom_full_content").addClass("arrowchat_no_userlist")),a(".arrowchat_chatroom_message_input").focus()}),a("#arrowchat_chatroom_password_input").keydown(function(t){13==t.keyCode&&(c=a("#arrowchat_chatroom_password_id").val(),a("#arrowchat_chatroom_password_flyout").hide(),input_value=a("#arrowchat_chatroom_password_input").val(),a("#arrowchat_chatroom_password_input").val(""),loadChatroom(c,input_value=input_value.replace(/^\s+|\s+$/g,"")),loadChatroomList())}),a("#arrowchat_password_button").click(function(){c=a("#arrowchat_chatroom_password_id").val(),a("#arrowchat_chatroom_password_flyout").hide(),input_value=a("#arrowchat_chatroom_password_input").val(),a("#arrowchat_chatroom_password_input").val(""),loadChatroom(c,input_value=input_value.replace(/^\s+|\s+$/g,"")),loadChatroomList()}),a("body").click(function(t){a(t.target).closest("#arrowchat_chatroom_password_flyout").length||a(t.target).closest(".arrowchat_chatroom_list").length||(a("#arrowchat_chatroom_password_flyout").hide(),a(".arrowchat_chatroom_full_content").removeClass("arrowchat_chatroom_opacity"),a(".arrowchat_chatroom_list").removeClass("arrowchat_chatroom_clicked"))}),a("#arrowchat_chatroom_create_input").keydown(function(t){13==t.keyCode&&startCreateChatRoom()}),a("#arrowchat_create_button").click(function(){startCreateChatRoom()})}function buildModButton(){if(a("#arrowchat_setting_mod_cp").show(),a("#arrowchat_setting_mod_cp").click(function(){window.open(c_ac_path+"mod/","_blank","");var t=parseInt(a(".arrowchat_mobiletab_new_count").html()),r=parseInt(a("#arrowchat_more_notification").html());t-r<=0&&a("#arrowchat_mobiletab_new").hide(),a(".arrowchat_mobiletab_new_count").html(parseInt(t-r)),a("#arrowchat_more_notification_modcp").hide(),a("#arrowchat_more_notification").hide()}),u_num_mod_reports>0){var t=parseInt(a(".arrowchat_mobiletab_new_count").html())+parseInt(u_num_mod_reports);a(".arrowchat_mobiletab_new_count").html(t),a("#arrowchat_mobiletab_new").show(),a("#arrowchat_more_notification").show().html(u_num_mod_reports),a("#arrowchat_more_notification_modcp").show().html(u_num_mod_reports)}}function displayWelcome(){1==c_first_time_message_on&&($body.append(ArrowChat.Templates.welcome_display(c_first_time_message_header,c_first_time_message_content)),setTimeout(function(){a("#arrowchat_welcome").hide("slow")},1e4))}function receiveWarning(t){if(0==t.read&&""!=t.data){if(a("#arrowchat_warnings").remove(),$body.append(ArrowChat.Templates.warnings_display(t)),a("#arrowchat_announcement").length){var r=parseInt(a(window).height()-a("#arrowchat_announcement").position().top);a("#arrowchat_warnings").css("bottom",r+5+"px")}a("#arrowchat_warnings .arrowchat_warnings_close").click(function(){if(a("#arrowchat_warnings").remove(),a("#arrowchat_announcement").length)var t=parseInt(a("#arrowchat_mobiletab").outerHeight()+parseInt(a("#arrowchat_mobiletab").css("bottom"))+3);a("#arrowchat_announcement").css("bottom",t+"px"),a.post(c_ac_path+"includes/json/send/send_settings.php",{warning_read:1},function(){})})}else a("#arrowchat_warnings").remove()}function buildOptionsButton(){if(0==c_notifications){a(".arrowchat_bell_button").hide();return}a(".arrowchat_bell_button").mouseenter(function(t){t.target==this&&(showTooltip(a(this),lang[0],0,10,0),a(this).addClass("arrowchat_bell_button_hover"))}),a(".arrowchat_bell_button").mouseleave(function(t){t.target==this&&(hideTooltip(),a(this).removeClass("arrowchat_bell_button_hover"))}),a(".arrowchat_bell_button").click(function(t){if(t.target==this&&(hideTooltip(),a("#arrowchat_bell_flyout").toggleClass("arrowchat_bell_flyout_display"),a(this).toggleClass("arrowchat_bell_button_selected"),lsClick(".arrowchat_bell_button","ac_openclose"),Q>0)){var r=parseInt(a(".arrowchat_mobiletab_new_count").html());r-Q<=0&&a("#arrowchat_mobiletab_new").hide(),a("#arrowchat_bell_notification").hide(),a(".arrowchat_mobiletab_new_count").html(parseInt(r-Q)),a.post(c_ac_path+"includes/json/send/send_notifications.php",{userid:u_id},function(){}),Q=0}}),a("body").click(function(t){a(t.target).closest(".arrowchat_bell_button").length||a("#arrowchat_bell_flyout").removeClass("arrowchat_bell_flyout_display")}),a(".arrowchat_see_all_button").mouseenter(function(){showTooltip(a(this),lang[21],0,10,5),a(this).addClass("arrowchat_see_all_button_hover")}),a(".arrowchat_see_all_button").mouseleave(function(){hideTooltip(),a(this).removeClass("arrowchat_see_all_button_hover")}),a(".arrowchat_see_all_button").click(function(){lsClick(".arrowchat_see_all_button","ac_click"),a("#arrowchat_notifications_content").html('<div class="arrowchat_loading_icon" style="padding:20px 0"></div>');var t=0;a.ajax({url:c_ac_path+"includes/json/receive/receive_notifications.php",type:"get",cache:!1,dataType:"json",success:function(r){r&&null!=r&&(a("#arrowchat_notifications_content").html(""),a.each(r,function(r,o){a.each(o,function(r,o){a("<div/>").attr("id","arrowchat_alert_"+o.alert_id).attr("class","arrowchat_notification_message_div").html(o.markup).appendTo(a("#arrowchat_notifications_content")),t++})}),0==t?a("#arrowchat_notifications_content").html('<div id="arrowchat_no_new_notifications"><i class="fa-solid fa-bell-slash"></i>'+lang[9]+"</div>"):(a(".arrowchat_notifications_divider").removeClass("arrowchat_notifications_divider_last"),a("#arrowchat_notifications_content div:last-child .arrowchat_notifications_divider").addClass("arrowchat_notifications_divider_last")))}})}),preventScrolling(a("#arrowchat_notifications_content"))}function displayMessage(t,r,o){t.is(":visible")?(clearTimeout(message_timeout),t.hide("slide",{direction:"up"},250,function(){t.find(".arrowchat_message_text").html(r),"error"==o&&a(".arrowchat_message_box").addClass("arrowchat_message_box_error").removeClass("arrowchat_message_box_notice"),"notice"==o&&a(".arrowchat_message_box").addClass("arrowchat_message_box_notice").removeClass("arrowchat_message_box_error"),t.show("slide",{direction:"up"},250)})):("error"==o&&a(".arrowchat_message_box").addClass("arrowchat_message_box_error").removeClass("arrowchat_message_box_notice"),"notice"==o&&a(".arrowchat_message_box").addClass("arrowchat_message_box_notice").removeClass("arrowchat_message_box_error"),t.find(".arrowchat_message_text").html(r),t.show("slide",{direction:"up"},250)),message_timeout=setTimeout(function(){t.hide("slide",{direction:"up"},250)},5e3)}function loadGiphy(t,r,o){var e;e=1==r?$user_popups[o]:$chatrooms_popups[o],a.ajax({url:t,type:"get",cache:!1,dataType:"json",xhr:function(){var t=a.ajaxSettings.xhr(),r=t.setRequestHeader;return t.setRequestHeader=function(t,o){"X-Socket-Id"!=t&&r.call(this,t,o)},t},success:function(t){t&&a.each(t,function(t,s){if("data"==t){a(".arrowchat_giphy_image_wrapper",e).html("");var n=0;a.each(s,function(t,r){n=Math.round(270/(r.images.fixed_height_downsampled.width/r.images.fixed_height_downsampled.height)),a(".arrowchat_giphy_image_wrapper",e).append('<img class="arrowchat_giphy_image" src="'+r.images.fixed_height_downsampled.url+'" alt="" style="height:'+n+'px;width:270px" height="'+n+'" />')}),a(".arrowchat_giphy_image",e).click(function(){a(".arrowchat_giphy_popout",e).children(".arrowchat_more_popout").hide();var t=a(this).attr("src");2==r?a.post(c_ac_path+"includes/json/send/send_message_chatroom.php",{userid:u_id,username:u_name,chatroomid:o,message:"giphy{"+a(this).attr("height")+"}{"+a(this).attr("src")+"}"},function(r){if(a.isNumeric(r)){if(a("#arrowchat_chatroom_message_"+r).length);else{var e=formatTimestamp(new Date(1e3*Math.floor((new Date).getTime()/1e3)),1);a(".arrowchat_tabcontenttext",$chatrooms_popups[o]).append('<div class="arrowchat_chatroom_box_message arrowchat_self arrowchat_image_msg arrowchat_chatroom_important" id="arrowchat_chatroom_message_'+r+'"><div class="arrowchat_chatroom_message_name">'+u_name+'</div><div class="arrowchat_chatroom_msg_wrap"><div class="arrowchat_chatroom_message_content" data-id="'+e+'"><span class="arrowchat_chatroom_msg"><div class="arrowchat_giphy_message"><img class="arrowchat_lightbox arrowchat_giphy_img" data-id="'+t+'" src="'+t+'" alt="" /></div></span></div><div class="arrowchat_message_controls"><div class="arrowchat_chatroom_reply"><i class="fas fa-reply"></i></div><div class="arrowchat_chatroom_delete" data-id="'+r+'"><i class="far fa-xmark"></i></div></div></div><div class="arrowchat_pending_icon arrowchat_pending_delivered"></div></div>'),lsClick(JSON.stringify([r,u_name,'<div class="arrowchat_giphy_message"><img class="arrowchat_lightbox arrowchat_giphy_img" data-id="'+t+'" src="'+t+'" alt="" /></div>',o]),"send_chatroom_message"),showChatroomTime()}}else a.each(r,function(t,r){"error"==t&&a.each(r,function(t,r){displayMessage(a("#arrowchat_chatroom_message_flyout"),r.m,"error")})});a(".arrowchat_tabcontenttext",$chatrooms_popups[o]).scrollTop(5e4)}):a.post(c_ac_path+"includes/json/send/send_message.php",{userid:u_id,to:o,message:"giphy{"+a(this).attr("height")+"}{"+a(this).attr("src")+"}"},function(r){if(a.isNumeric(r)){if(a("#arrowchat_message_"+r).length);else{var e=formatTimestamp(new Date(1e3*Math.floor((new Date).getTime()/1e3)),1);a(".arrowchat_tabcontenttext",$user_popups[o]).append('<div class="arrowchat_chatboxmessage arrowchat_clearfix arrowchat_self arrowchat_image_msg" id="arrowchat_message_'+r+'"><span class="arrowchat_ts" style="display: none;"></span><div class="arrowchat_chatboxmessagefrom arrowchat_white_background"><div class="arrowchat_disable_avatars_name">'+u_name+'</div></div><div class="arrowchat_chatboxmessage_wrapper"><div class="arrowchat_chatboxmessagecontent" data-id="'+e+'"><div class="arrowchat_giphy_message"><img class="arrowchat_lightbox arrowchat_giphy_img" data-id="'+t+'" src="'+t+'" alt="" /></div></div></div><div class="arrowchat_pending_icon arrowchat_pending_delivered"></div></div>'),lsClick(JSON.stringify([r,o,'<div class="arrowchat_giphy_message"><img class="arrowchat_lightbox arrowchat_giphy_img" data-id="'+t+'" src="'+t+'" alt="" /></div>',Math.floor((new Date).getTime()/1e3),1,1]),"private_message"),showTimeAndTooltip()}}else a.each(r,function(t,r){"error"==t&&a.each(r,function(t,r){displayMessage(a(".arrowchat_message_box",$user_popups[o]),r.m,"error")})});a(".arrowchat_tabcontenttext",$user_popups[o]).scrollTop(a(".arrowchat_tabcontenttext",$user_popups[o])[0].scrollHeight)})})}})}})}function leaveChatroom(t){lsClick(".arrowchat_closebox_bottom","ac_click","chatrooms['"+t+"']"),a.post(c_ac_path+"includes/json/send/send_settings.php",{close_chat:"r"+t},function(){}),$chatrooms_popups[t].remove(),$chatrooms[t].remove(),delete $chatrooms_popups[t],delete $chatrooms[t],adjustSizes(),room_history_loaded[t]=0,Object.keys($chatrooms).length<1&&(clearTimeout(Crref2),Crref2=-1),1!=c_push_engine&&(cancelJSONP(),receiveCore()),changePushChannel(t,0)}function initialChatroomLoad(t,r){var o=0,e=0,s="",n="",h="";chatroom_mod[t]=0,chatroom_admin[t]=0,a(".arrowchat_tabcontenttext",$chatrooms_popups[t]).html('<div class="arrowchat_nofriends"><div class="arrowchat_loading_icon"></div></div>'),a.ajax({url:c_ac_path+"includes/json/receive/receive_chatroom_room.php",data:{chatroomid:t,chatroom_pw:r},type:"post",cache:!1,dataType:"json",success:function(r){if(r){var l=!0;r&&a.each(r,function(r,o){"error"==r&&a.each(o,function(r,o){l=!1,void 0!==$chatrooms[t]&&a(".arrowchat_closebox_bottom",$chatrooms[t]).click(),loadChatroomList(),displayMessage(a("#arrowchat_chatroom_message_flyout"),o.m,"error")})}),l&&(lsClick(t,"open_chatroom"),-1==Crref2&&(Crref2=setTimeout(function(){receiveChatroom()},3e4)),1!=c_push_engine?(cancelJSONP(),changePushChannel(t,1),receiveCore()):changePushChannel(t,1),r&&a.each(r,function(r,l){if("user_title"==r&&a.each(l,function(r,s){1==s.admin&&(e=1,chatroom_admin[t]=1),1==s.mod&&(o=1,chatroom_mod[t]=1)}),"chat_name"==r&&a.each(l,function(r,o){void 0===cr_name[t]&&(cr_name[t]=o.n)}),"chat_users"==r){var d,w=0,m=0,u=0,p=0;a(".arrowchat_room_userlist",$chatrooms_popups[t]).html('<div class="arrowchat_chatroom_line_admins" class="arrowchat_group_container"><span class="arrowchat_group_text">'+lang[148]+'</span><div class="arrowchat_group_line_container"><span class="arrowchat_group_line"></span></div></div><div class="arrowchat_chatroom_list_admins"></div><div class="arrowchat_chatroom_line_mods" class="arrowchat_group_container"><span class="arrowchat_group_text">'+lang[149]+'</span><div class="arrowchat_group_line_container"><span class="arrowchat_group_line"></span></div></div><div class="arrowchat_chatroom_list_mods"></div><div class="arrowchat_chatroom_line_users" class="arrowchat_group_container"><span class="arrowchat_group_text">'+lang[147]+'</span><div class="arrowchat_group_line_container"><span class="arrowchat_group_line"></span></div></div><div class="arrowchat_chatroom_list_users"></div>'),a(".arrowchat_chatroom_user_popouts",$chatrooms_popups[t]).html(""),a.each(l,function(r,n){if("invisible"!=n.status){p++,(1==e||1==o)&&(1==n.t||4==n.t)&&(s='<li class="arrowchat_menu_separator"></li><li class="arrowchat_menu_item"><a class="arrowchat_chatroom_make_mod arrowchat_menu_anchor"><i class="fa-light fa-user-crown"></i><span>'+lang[52]+'</span></a></li><li class="arrowchat_menu_item"><a class="arrowchat_chatroom_silence_user arrowchat_menu_anchor"><i class="fa-light fa-volume-xmark"></i><span>'+lang[161]+'</span></a></li><li class="arrowchat_menu_item"><a class="arrowchat_chatroom_ban_user arrowchat_menu_anchor"><i class="fa-light fa-ban"></i><span>'+lang[53]+"</span></a></li>"),1==e&&2==n.t&&(s='<li class="arrowchat_menu_separator"></li><li class="arrowchat_menu_item"><a class="arrowchat_chatroom_remove_mod arrowchat_menu_anchor"><i class="fa-light fa-circle-minus"></i><span>'+lang[54]+"</span></a></li>"),appendVal=a(".arrowchat_chatroom_list_users",$chatrooms_popups[t]),2==n.t?(appendVal=a(".arrowchat_chatroom_list_mods",$chatrooms_popups[t]),m++):3==n.t?(appendVal=a(".arrowchat_chatroom_list_admins",$chatrooms_popups[t]),w++):u++,d=renderHTMLString(n.n),n.n=renderHTMLString(n.n);var h=" fas fa-circle";"away"==n.status?h=" fas fa-moon":"busy"==n.status&&(h=" far fa-mobile-screen"),a("<div/>").attr("data-user-pop-id",n.id).attr("class","arrowchat_chatroom_user").mouseover(function(){a(this).addClass("arrowchat_chatroom_list_hover")}).mouseout(function(){a(this).removeClass("arrowchat_chatroom_list_hover")}).addClass("arrowchat_chatroom_room_list").addClass("arrowchat_chatroom_admin_"+n.t).html('<img class="arrowchat_chatroom_avatar" src="'+n.a+'"/><span class="arrowchat_chatroom_room_name">'+n.n+'</span><span class="arrowchat_userscontentdot arrowchat_'+n.status+h+'"></span>').appendTo(appendVal);var l="";(1==n.b&&1!=e||n.id==u_id)&&(l=" arrowchat_no_private_msg"),a("<div/>").attr("data-user-id",n.id).addClass("arrowchat_more_wrapper_chatroom").html('<div class="arrowchat_more_popout"><div class="arrowchat_chatroom_flyout_avatar"><img src="'+n.a+'" alt="" /></div><ul class="arrowchat_inner_menu arrowchat_chatroom_flyout_info"><li class="arrowchat_menu_item"><a class="arrowchat_chatroom_title arrowchat_menu_anchor"><span class="arrowchat_chatroom_fullname">'+d+'</span></a></li><li class="arrowchat_menu_item"><a class="arrowchat_menu_anchor arrowchat_chatroom_private_message'+l+'"><i class="fa-light fa-messages"></i><span>'+lang[41]+'</span></a></li><li class="arrowchat_menu_item"><a class="arrowchat_menu_anchor arrowchat_chatroom_block_user"><i class="fa-light fa-user-slash"></i><span>'+lang[84]+'</span></a></li><li class="arrowchat_menu_item"><a class="arrowchat_menu_anchor arrowchat_chatroom_report_user"><i class="fa-light fa-triangle-exclamation"></i><span>'+lang[167]+"</span></a></li>"+s+"</ul></div>").appendTo(a(".arrowchat_chatroom_user_popouts",$chatrooms_popups[t])),2==n.t?a("#arrowchat_chatroom_title_"+n.id,$chatrooms_popups[t]).html('<a href="'+n.l+'">'+d+"</a><br/>"+lang[44]):3==n.t?a("#arrowchat_chatroom_title_"+n.id,$chatrooms_popups[t]).html('<a href="'+n.l+'">'+d+"</a><br/>"+lang[45]):4==n.t&&a("#arrowchat_chatroom_title_"+n.id,$chatrooms_popups[t]).html('<a href="'+n.l+'">'+d+"</a><br/>"+lang[212]),addHover(a(".arrowchat_menu_item"),"arrowchat_more_hover")}uc_cr_block[n.id]=n.b}),chatroomUserOptions(e);var v=function(t,r){return t.querySelector(".arrowchat_chatroom_room_name").innerHTML.toLowerCase().localeCompare(r.querySelector(".arrowchat_chatroom_room_name").innerHTML.toLowerCase())},g=a(".arrowchat_chatroom_list_users > div",$chatrooms_popups[t]).get();g.sort(v);for(var r=0;r<g.length;r++)g[r].parentNode.appendChild(g[r]);a(".arrowchat_chatroom_count_window span",$chatrooms_popups[t]).html(p),a(".arrowchat_chatroom_count_window span",$chatrooms[t]).html(p),a("#arrowchat_chatroom_"+t).find(".arrowchat_chatroom_count").children("span").html(p),0==u&&a(".arrowchat_chatroom_line_users",$chatrooms_popups[t]).hide(),0==w&&a(".arrowchat_chatroom_line_admins",$chatrooms_popups[t]).hide(),0==m&&a(".arrowchat_chatroom_line_mods",$chatrooms_popups[t]).hide(),a(".arrowchat_chatroom_admin_3").css("background-color","#"+c_admin_bg),a(".arrowchat_chatroom_admin_3").css("color","#"+c_admin_txt)}"chat_history"==r&&(n="",a.each(l,function(t,r){var o=RegExp("(^|\\s)(@"+u_name+")(\\s|$)","i");if(r.m=r.m.replace(o,'$1<span class="arrowchat_at_user">$2</span>$3'),void 0===blockList[r.userid]){var e="",s="";1==r.mod&&(e=lang[137],s=" arrowchat_chatroom_important"),1==r.admin&&(e=lang[137],s=" arrowchat_chatroom_important"),t="";var h="";fromname=r.n;var l="";r.n==u_name&&(t=" arrowchat_self",l="<div class='arrowchat_pending_icon arrowchat_pending_delivered'></div>"),"<div"==r.m.substr(0,4)&&(h=" arrowchat_image_msg");var d=new Date(1e3*r.t),w=formatTimestamp(d,1);if(1==r.global)n+='<div class="arrowchat_chatroom_box_message arrowchat_global_chatroom_message" id="arrowchat_chatroom_message_'+r.id+'"><div class="arrowchat_chatroom_message_content'+t+'">'+formatTimestamp(d)+r.m+"</div></div>";else{var m=getRandomColor(fromname);n+='<div class="arrowchat_chatroom_box_message'+t+h+s+'" id="arrowchat_chatroom_message_'+r.id+'"><div class="arrowchat_chatroom_message_name"><i class="'+e+'"></i>'+fromname+'</div><div class="arrowchat_chatroom_msg_wrap"><div class="arrowchat_chatbox_avatar_wrapper arrowchat_white_background" style="background-color:'+m.color+'"><img class="arrowchat_chatroom_message_avatar arrowchat_no_names" src="'+r.a+'" alt="'+fromname+'" /><span class="arrowchat_tab_letter arrowchat_tab_letter_xsmall">'+m.character+'</span></div><div class="arrowchat_chatroom_message_content" data-id="'+w+'"><span class="arrowchat_chatroom_msg">'+r.m+'</span></div><div class="arrowchat_message_controls"><div class="arrowchat_chatroom_reply"><i class="fas fa-reply"></i></div><div class="arrowchat_chatroom_delete" data-id="'+r.id+'"><i class="far fa-xmark"></i></div></div></div>'+l+"</div>"}}})),"room_info"==r&&a.each(l,function(r,o){""!=o.welcome_msg&&(h=stripslashes(o.welcome_msg),cr_welcome[t]=h,h=replaceURLWithHTMLLinks(h)),cr_desc[t]=o.desc,room_limit_msg[t]=o.limit_msg,room_limit_sec[t]=o.limit_sec})}),a(".arrowchat_tabcontenttext",$chatrooms_popups[t]).html(n),showChatroomTime(),a(".arrowchat_tabcontenttext",$chatrooms_popups[t]).append('<div class="arrowchat_chatroom_box_message arrowchat_chatroom_welcome_msg arrowchat_global_chatroom_message"><div class="arrowchat_chatroom_message_content">'+h+"</div></div>"),a(".arrowchat_pending_icon:not(.arrowchat_pending_error)",$chatrooms_popups[t]).hide(),a(".arrowchat_tabcontenttext .arrowchat_chatroom_box_message .arrowchat_pending_icon:last",$chatrooms_popups[t]).show(),modDeleteControls(t),preventScrolling(a(".arrowchat_tabcontenttext",$chatrooms_popups[t])),preventScrolling(a(".arrowchat_room_userlist")),(1==c_disable_avatars||a("#arrowchat_setting_names_only :input").is(":checked"))&&setAvatarVisibility(1),a(".arrowchat_tabcontenttext",$chatrooms_popups[t]).scrollTop(5e4),a(".arrowchat_textarea",$chatrooms_popups[t]).focus(),1==e||1==o?addChatroomAdminControls(t):a(".arrowchat_admin_controls",$chatrooms_popups[t]).hide(),a(".arrowchat_image_msg img,.arrowchat_emoji_text img").one("load",function(){a(".arrowchat_tabcontenttext",$chatrooms_popups[t]).scrollTop(5e4)}).each(function(){this.complete&&a(this).trigger("load")}))}}})}function loadChatroom(a,t){toggleUserChatTab(a,0,!0,t)}function modDeleteControls(t){1==chatroom_mod[t]||1==chatroom_admin[t]?(a(".arrowchat_chatroom_delete",$chatrooms_popups[t]).show(),a(".arrowchat_chatroom_delete",$chatrooms_popups[t]).unbind("mouseenter").unbind("mouseleave").unbind("click"),a(".arrowchat_chatroom_delete",$chatrooms_popups[t]).mouseenter(function(){showTooltip(a(this),lang[160],0,10,10),a(this).addClass("arrowchat_chatroom_delete_hover")}),a(".arrowchat_chatroom_delete",$chatrooms_popup).mouseleave(function(){hideTooltip(),a(this).removeClass("arrowchat_chatroom_delete_hover")}),a(".arrowchat_chatroom_delete").click(function(){hideTooltip();var t=a(this).attr("data-id"),r=a(this).parents(".arrowchat_tabpopup").attr("data-room-id");a("#arrowchat_chatroom_message_"+t+" .arrowchat_chatroom_delete").remove(),a.post(c_ac_path+"includes/json/send/send_settings.php",{delete_msg:t,chatroom_id:r,delete_name:u_name},function(){a("#arrowchat_chatroom_message_"+t+" .arrowchat_chatroom_msg").html(lang[159]+u_name)})})):a(".arrowchat_chatroom_delete",$chatrooms_popups[t]).hide()}function chatroomUploadProcessing(t){var r=Math.round(new Date().getTime()),o=c_ac_path.replace("../","/");a(".arrowchat_file_transfer_user",$chatrooms_popups[t]).uploadifive({uploadScript:o+"includes/classes/class_uploads.php",buttonText:" ",buttonClass:"arrowchat_upload_user_button",removeCompleted:!0,formData:{unixtime:r,user:u_id},queueID:"arrowchat_room_upload_queue_"+t,height:"25px",width:"100%",multi:!1,auto:!0,fileType:".avi,.bmp,.doc,.docx,.gif,.ico,.jpeg,.jpg,.mp3,.mp4,.pdf,.png,.ppt,.pptx,.rar,.tar,.txt,.wav,.wmv,.xls,.xlsx,.zip,.7z",fileSizeLimit:c_max_upload_size+"MB",onError:function(r,o,e,s){a(".arrowchat_textarea",$chatrooms_popups[t]).focus()},onCancel:function(r){a(".arrowchat_textarea",$chatrooms_popups[t]).focus()},onUploadComplete:function(o){var e="file",s=o.type.toLowerCase();("image/jpeg"==s||"image/gif"==s||"image/jpg"==s||"image/png"==s)&&(e="image"),a.post(c_ac_path+"includes/json/send/send_message_chatroom.php",{userid:u_id,username:u_name,chatroomid:t,message:e+"{"+r+"}{"+o.name+"}"},function(s){if(a.isNumeric(s)){if(a("#arrowchat_chatroom_message_"+s).length);else{var n="",h=formatTimestamp(new Date(1e3*Math.floor((new Date).getTime()/1e3)),1);"image"==e?(a(".arrowchat_tabcontenttext",$chatrooms_popups[t]).append('<div id="arrowchat_chatroom_message_'+s+'" class="arrowchat_chatroom_important arrowchat_image_msg arrowchat_self arrowchat_chatroom_box_message"><div class="arrowchat_chatroom_message_name">'+u_name+'</div><div class="arrowchat_chatroom_msg_wrap"><div class="arrowchat_chatroom_message_content" data-id="'+h+'"><span class="arrowchat_chatroom_msg"><div class="arrowchat_image_message"><img data-id="'+c_ac_path+"public/download.php?file="+r+'" src="'+c_ac_path+"public/download.php?file="+r+'_t" alt="Image" class="arrowchat_lightbox" /></div></span></div><div class="arrowchat_message_controls"><div class="arrowchat_chatroom_reply"><i class="fas fa-reply"></i></div><div class="arrowchat_chatroom_delete" data-id="'+s+'"><i class="far fa-xmark"></i></div></div></div><div class="arrowchat_pending_icon arrowchat_pending_delivered"></div></div>'),n='<div class="arrowchat_image_message"><img data-id="'+c_ac_path+"public/download.php?file="+r+'" src="'+c_ac_path+"public/download.php?file="+r+'_t" alt="Image" class="arrowchat_lightbox" /></div>',a(".arrowchat_image_msg img,.arrowchat_emoji_text img").one("load",function(){setTimeout(function(){a(".arrowchat_tabcontenttext",$chatrooms_popups[t]).scrollTop(5e4)},500)}).each(function(){this.complete&&a(this).trigger("load")})):(a(".arrowchat_tabcontenttext",$chatrooms_popups[t]).append('<div id="arrowchat_chatroom_message_'+s+'" class="arrowchat_chatroom_important arrowchat_image_msg arrowchat_self arrowchat_chatroom_box_message"><div class="arrowchat_chatroom_message_name">'+u_name+'</div><div class="arrowchat_chatroom_msg_wrap"><div class="arrowchat_chatroom_message_content" data-id="'+h+'"><span class="arrowchat_chatroom_msg"><div class="arrowchat_action_message"><div class="arrowchat_action_message_wrapper">'+lang[69]+'</div><div class="arrowchat_action_message_action"><a href="'+c_ac_path+"public/download.php?file="+r+'">'+o.name+'</a></div></div></span></div><div class="arrowchat_message_controls"><div class="arrowchat_chatroom_reply"><i class="fas fa-reply"></i></div><div class="arrowchat_chatroom_delete" data-id="'+s+'"><i class="far fa-xmark"></i></div></div></div><div class="arrowchat_pending_icon arrowchat_pending_delivered"></div></div>'),n='<div class="arrowchat_action_message"><div class="arrowchat_action_message_wrapper">'+lang[69]+'</div><div class="arrowchat_action_message_action"><a href="'+c_ac_path+"public/download.php?file="+r+'">'+o.name+"</a></div></div>"),showChatroomTime(),lsClick(JSON.stringify([s,u_name,n,t]),"send_chatroom_message")}}else a.each(s,function(r,o){"error"==r&&a.each(o,function(r,o){displayMessage(a(".arrowchat_message_box",$chatrooms_popups[t]),o.m,"error")})});a(".arrowchat_tabcontenttext",$chatrooms_popups[t]).scrollTop(5e4)}),a(".arrowchat_textarea",$chatrooms_popups[t]).focus(),chatroomUploadProcessing(t)}})}function addChatroomAdminControls(t){a(".arrowchat_admin_controls",$chatrooms_popups[t]).show(),a(".arrowchat_edit_welcome_msg",$chatrooms_popups[t]).unbind("click"),a(".arrowchat_edit_welcome_msg",$chatrooms_popups[t]).click(function(){var r=prompt(lang[154],cr_welcome[t]);(r||""==r)&&a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_welcome_msg:r,chatroom_id:t},function(){displayMessage(a(".arrowchat_message_box",$chatrooms_popups[t]),lang[155],"notice"),cr_welcome[t]=r,a(".arrowchat_more_anchor",$chatrooms_popups[t]).click()})}),1==chatroom_admin[t]?(1==u_chatroom_invisible?a(".arrowchat_chatroom_invisible .arrowchat_switch :input",$chatrooms_popups[t]).prop("checked",!0):(a(".arrowchat_chatroom_invisible").addClass("arrowchat_menu_unchecked"),a(".arrowchat_chatroom_invisible .arrowchat_switch :input",$chatrooms_popups[t]).prop("checked",!1)),a(".arrowchat_chatroom_invisible",$chatrooms_popups[t]).unbind("click"),a(".arrowchat_chatroom_invisible",$chatrooms_popups[t]).click(function(){a(".arrowchat_chatroom_invisible").toggleClass("arrowchat_menu_unchecked"),a(".arrowchat_chatroom_invisible :input",$chatrooms_popups[t]).is(":checked")?(a(".arrowchat_chatroom_invisible :input").prop("checked",!1),_chatroominvis=-1,u_chatroom_invisible=0):(a(".arrowchat_chatroom_invisible :input").prop("checked",!0),_chatroominvis=1,u_chatroom_invisible=1),a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_invisible:_chatroominvis},function(){})})):a(".arrowchat_chatroom_invisible").parent(".arrowchat_admin_controls").hide(),a(".arrowchat_edit_description",$chatrooms_popups[t]).unbind("click"),a(".arrowchat_edit_description",$chatrooms_popups[t]).click(function(){var r=prompt(lang[158],cr_desc[t]);(r||""==r)&&a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_description:r,chatroom_id:t},function(){displayMessage(a(".arrowchat_message_box",$chatrooms_popups[t]),lang[155],"notice"),cr_desc[t]=r,r=renderHTMLString(r),loadChatroomList(),a(".arrowchat_name_description",$chatrooms_popups[t]).html(r),a(".arrowchat_more_anchor",$chatrooms_popups[t]).click()})}),a(".arrowchat_edit_flood",$chatrooms_popups[t]).unbind("click"),a(".arrowchat_edit_flood",$chatrooms_popups[t]).click(function(){a(this).parents(".arrowchat_inner_menu").hide(),a(".arrowchat_flood_select_messages",$chatrooms_popups[t]).val(room_limit_msg[t]),a(".arrowchat_flood_select_seconds",$chatrooms_popups[t]).val(room_limit_sec[t]),a(".arrowchat_flood_menu",$chatrooms_popups[t]).show()}),a(".arrowchat_flood_back",$chatrooms_popups[t]).unbind("click"),a(".arrowchat_flood_back",$chatrooms_popups[t]).click(function(){a(this).parents(".arrowchat_more_popout").find(".arrowchat_inner_menu").show(),a(".arrowchat_flood_menu",$chatrooms_popups[t]).hide()}),a(".arrowchat_flood_save",$chatrooms_popups[t]).unbind("click"),a(".arrowchat_flood_save",$chatrooms_popups[t]).click(function(){a(".arrowchat_more_anchor",$chatrooms_popups[t]).click();var r=a(".arrowchat_flood_select_messages",$chatrooms_popups[t]).val(),o=a(".arrowchat_flood_select_seconds",$chatrooms_popups[t]).val();isNaN(r)||isNaN(o)||a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_id:t,flood_message:r,flood_seconds:o},function(){displayMessage(a(".arrowchat_message_box",$chatrooms_popups[t]),lang[155],"notice"),room_limit_msg[t]=r,room_limit_sec[t]=o})})}function receiveUser(t,r,o,e,s,n,h){null==t||""==t||(null==uc_name[t]||""==uc_name[t]?1!=aa[t]?(aa[t]=1,a.ajax({url:c_ac_path+"includes/json/receive/receive_user.php",data:{userid:t},type:"post",cache:!1,dataType:"json",success:function(h){h&&(r=uc_name[t]=h.n,o=uc_status[t]=h.s,e=uc_avatar[t]=h.a,s=uc_link[t]=h.l,null!=G[t]&&"undefined"!=typeof $user&&(a(".arrowchat_closed_status",$user[t]).removeClass("arrowchat_available arrowchat_busy arrowchat_offline").addClass("arrowchat_"+o),a(".arrowchat_closed_statusy",$user_popups[t]).removeClass("arrowchat_available arrowchat_busy arrowchat_offline").addClass("arrowchat_"+o),$users[t].removeClass("arrowchat_tab_offline").addClass("arrowchat_tab_"+r),void 0!==$user_popups[t]&&a(".arrowchat_tabsubtitle .arrowchat_message",$user_popups[t]).html(i)),aa[t]=0,null!=r?toggleUserChatTab(t,n,!1,""):a.post(c_ac_path+"includes/json/send/send_settings.php",{unfocus_chat:t},function(){}))}})):setTimeout(function(){receiveUser(t,uc_name[t],uc_status[t],uc_avatar[t],uc_link[t],n,h)},500):toggleUserChatTab(t,n,!1,""))}function userUploadProcessing(t){var r=Math.round(new Date().getTime()),o=c_ac_path.replace("../","/");a(".arrowchat_file_transfer_user",$user_popups[t]).uploadifive({uploadScript:o+"includes/classes/class_uploads.php",buttonText:" ",buttonClass:"arrowchat_upload_user_button",removeCompleted:!0,formData:{unixtime:r,user:u_id},queueID:"arrowchat_user_upload_queue_"+t,height:"25px",width:"100%",multi:!1,auto:!0,fileType:".avi,.bmp,.doc,.docx,.gif,.ico,.jpeg,.jpg,.mp3,.mp4,.pdf,.png,.ppt,.pptx,.rar,.tar,.txt,.wav,.wmv,.xls,.xlsx,.zip,.7z",fileSizeLimit:c_max_upload_size+"MB",onError:function(r,o,e,s){a(".arrowchat_textarea",$user_popups[t]).focus()},onCancel:function(r){a(".arrowchat_textarea",$user_popups[t]).focus()},onUploadComplete:function(o){var e="file",s=o.type.toLowerCase();("image/jpeg"==s||"image/gif"==s||"image/jpg"==s||"image/png"==s)&&(e="image"),a.post(c_ac_path+"includes/json/send/send_message.php",{userid:u_id,to:t,message:e+"{"+r+"}{"+o.name+"}"},function(s){if(a.isNumeric(s)){if(a("#arrowchat_message_"+s).length);else{var n="",h=formatTimestamp(new Date(1e3*Math.floor((new Date).getTime()/1e3)),1);"image"==e?(a(".arrowchat_tabcontenttext",$user_popups[t]).append('<div class="arrowchat_chatboxmessage arrowchat_clearfix arrowchat_self arrowchat_image_msg" id="arrowchat_message_'+s+'"><span class="arrowchat_ts" style="display: none;">'+h+'</span><div class="arrowchat_chatboxmessagefrom arrowchat_white_background"><div class="arrowchat_disable_avatars_name">'+u_name+'</div></div><div class="arrowchat_chatboxmessage_wrapper"><div class="arrowchat_chatboxmessagecontent" data-id="'+h+'"><div class="arrowchat_image_message"><img data-id="'+c_ac_path+"public/download.php?file="+r+'" src="'+c_ac_path+"public/download.php?file="+r+'_t" alt="Image" class="arrowchat_lightbox" /></div></div></div><div class="arrowchat_pending_icon arrowchat_pending_delivered"></div></div>'),n='<div class="arrowchat_image_message"><img data-id="'+c_ac_path+"public/download.php?file="+r+'" src="'+c_ac_path+"public/download.php?file="+r+'_t" alt="Image" class="arrowchat_lightbox" /></div>',a(".arrowchat_image_msg img,.arrowchat_emoji_text img").one("load",function(){setTimeout(function(){a(".arrowchat_tabcontenttext",$user_popups[t]).scrollTop(a(".arrowchat_tabcontenttext",$user_popups[t])[0].scrollHeight)},500)}).each(function(){this.complete&&a(this).trigger("load")})):(a(".arrowchat_tabcontenttext",$user_popups[t]).append('<div class="arrowchat_chatboxmessage arrowchat_clearfix arrowchat_self arrowchat_image_msg" id="arrowchat_message_'+s+'"><span class="arrowchat_ts" style="display: none;">'+h+'</span><div class="arrowchat_chatboxmessagefrom arrowchat_white_background"><div class="arrowchat_disable_avatars_name">'+u_name+'</div></div><div class="arrowchat_chatboxmessage_wrapper"><div class="arrowchat_chatboxmessagecontent" data-id="'+h+'"><div class="arrowchat_action_message"><div class="arrowchat_action_message_wrapper">'+lang[69]+'</div><div class="arrowchat_action_message_action"><a href="'+c_ac_path+"public/download.php?file="+r+'">'+o.name+'</a></div></div></div></div><div class="arrowchat_pending_icon arrowchat_pending_delivered"></div></div>'),n='<div class="arrowchat_action_message"><div class="arrowchat_action_message_wrapper">'+lang[69]+'</div><div class="arrowchat_action_message_action"><a href="'+c_ac_path+"public/download.php?file="+r+'">'+o.name+"</a></div></div>"),showTimeAndTooltip(),lsClick(JSON.stringify([s,t,n,Math.floor((new Date).getTime()/1e3),1,1]),"private_message")}}else a.each(s,function(r,o){"error"==r&&a.each(o,function(r,o){displayMessage(a(".arrowchat_message_box",$user_popups[t]),o.m,"error")})});a(".arrowchat_tabcontenttext",$user_popups[t]).scrollTop(a(".arrowchat_tabcontenttext",$user_popups[t])[0].scrollHeight)}),a(".arrowchat_textarea",$user_popups[t]).focus(),userUploadProcessing(t)}})}function leavechat(t){lsClick(".arrowchat_closebox_bottom","ac_click","users['"+t+"']"),a.post(c_ac_path+"includes/json/send/send_settings.php",{close_chat:t,tab_alert:1},function(){}),$user_popups[t].remove(),$users[t].remove(),delete $user_popups[t],delete $users[t],j==t&&(j=""),adjustSizes(),y[t]=null,G[t]=null,ca[t]=0}function toggleUserChatTab(t,r,o,e){var s,n;if(void 0!==$chatrooms[t]&&o||void 0!==$users[t]&&!o)o?$chatrooms[t].hasClass("arrowchat_tabclick")||1==r||$chatrooms[t].click():$users[t].hasClass("arrowchat_tabclick")||1==r||$users[t].click();else{if(o){void 0===cr_name[t]&&(cr_name[t]=lang[301]),void 0===cr_desc[t]&&(cr_desc[t]=lang[301]),void 0===cr_img[t]&&(cr_img[t]="chatroom_default.png");var h=renderHTMLString(cr_name[t]),l=c_ac_path+"themes/"+u_theme+"/images/icons/"+cr_img[t],d=renderHTMLString(cr_desc[t]);void 0===cr_count[t]&&(cr_count[t]=1),$chatrooms[t]=a(ArrowChat.Templates.chatrooms_tab(h,l,cr_count[t])).attr("data-room-id",t).prependTo($closed_windows),$chatrooms_popups[t]=a(ArrowChat.Templates.chatrooms_window(t,h,l,d,cr_count[t],c_max_chatroom_msg)).attr("data-room-id",t).addClass("arrowchat_chatroom_tabpopup").appendTo($open_windows),a(".arrowchat_chatroom_full_content").removeClass("arrowchat_chatroom_opacity"),a(".arrowchat_chatroom_list").removeClass("arrowchat_chatroom_clicked"),s=$chatrooms[t],n=$chatrooms_popups[t]}else{var h=renderHTMLString(uc_name[t]),w=getRandomColor(h);$users[t]=a(ArrowChat.Templates.chat_tab(h,uc_avatar[t])).attr("data-id",t).prependTo($closed_windows),$user_popups[t]=a(ArrowChat.Templates.chat_window(h,uc_avatar[t],uc_link[t],t)).attr("data-id",t).appendTo($open_windows),$users[t].children(".arrowchat_closed_status").addClass("arrowchat_"+uc_status[t]),$users[t].addClass("arrowchat_tab_"+uc_status[t]),a(".arrowchat_chat_window_status",$user_popups[t]).addClass("arrowchat_"+uc_status[t]),s=$users[t],n=$user_popups[t],a(".arrowchat_closed_image",s).css("background-color",w.color),a(".arrowchat_tab_letter",s).html(w.character),a(".arrowchat_avatarbox",n).css("background-color",w.color),a(".arrowchat_tab_letter_small",n).html(w.character)}adjustSizes(),orig_txt_size=a(".arrowchat_textarea",n).css("height"),a(".arrowchat_closebox_bottom",s).mouseenter(function(){a(this).addClass("arrowchat_closebox_bottomhover")}),a(".arrowchat_closebox_bottom",s).mouseleave(function(){a(this).removeClass("arrowchat_closebox_bottomhover")}),a(".arrowchat_closebox_bottom",s).click(function(){o?leaveChatroom(t):leavechat(t)}),1!=c_popout_on&&a(".arrowchat_chat_popout").parent().hide(),addHover(a(".arrowchat_menu_item",n),"arrowchat_more_hover"),a(".arrowchat_more_anchor",n).mouseenter(function(){a(".arrowchat_user_name_wrapper",n).addClass("arrowchat_user_image_hover"),showTooltip(a(this),lang[23],0,10,-10)}),a(".arrowchat_more_anchor",n).mouseleave(function(){a(".arrowchat_user_name_wrapper",n).removeClass("arrowchat_user_image_hover"),hideTooltip()}),a(".arrowchat_tabcontenttext",n).click(function(){window.getSelection().toString().length||a(".arrowchat_textarea",n).focus()}),a(".arrowchat_textarea",n).focus(function(){a(n).addClass("arrowchat_typing_title")}),a(".arrowchat_textarea",n).focusout(function(){a(n).removeClass("arrowchat_typing_title")}),preventScrolling(a(".arrowchat_emoji_wrapper",n)),preventScrolling(a(".arrowchat_giphy_image_wrapper",n)),a(".arrowchat_emoji_selector",n).click(function(){if(!a(this).hasClass("arrowchat_emoji_focused")){a(".arrowchat_emoji_wrapper",n).html('<div class="arrowchat_loading_icon"></div>'),a(".arrowchat_emoji_selector",n).removeClass("arrowchat_emoji_focused"),a(this).addClass("arrowchat_emoji_focused");var t=a(this).attr("data-id");a.ajax({url:c_ac_path+"includes/emojis/"+t+".php",type:"GET",cache:!0,success:function(t){a(".arrowchat_emoji_wrapper",n).html(t),a(".arrowchat_emoji",n).click(function(){if(a(this).hasClass("arrowchat_emoji_custom"))var t=a(this).children("img").attr("data-id");else var t=a(this).html();var r=a(".arrowchat_textarea",n).val();a(".arrowchat_textarea",n).focus().val("").val(r+t)})}})}}),a(".arrowchat_emoji_selector",n).mouseover(function(){a(this).addClass("arrowchat_emoji_selector_hover")}),a(".arrowchat_emoji_selector",n).mouseout(function(){a(this).removeClass("arrowchat_emoji_selector_hover")}),a(".arrowchat_emoji_smileys",n).mouseover(function(){showTooltip(a(this),lang[230],!1,0,20)}).mouseout(function(){hideTooltip()}),a(".arrowchat_emoji_animals",n).mouseover(function(){showTooltip(a(this),lang[231],!1,0,20)}).mouseout(function(){hideTooltip()}),a(".arrowchat_emoji_food",n).mouseover(function(){showTooltip(a(this),lang[232],!1,0,20)}).mouseout(function(){hideTooltip()}),a(".arrowchat_emoji_activities",n).mouseover(function(){showTooltip(a(this),lang[233],!1,0,20)}).mouseout(function(){hideTooltip()}),a(".arrowchat_emoji_travel",n).mouseover(function(){showTooltip(a(this),lang[234],!1,0,20)}).mouseout(function(){hideTooltip()}),a(".arrowchat_emoji_objects",n).mouseover(function(){showTooltip(a(this),lang[235],!1,0,20)}).mouseout(function(){hideTooltip()}),a(".arrowchat_emoji_symbols",n).mouseover(function(){showTooltip(a(this),lang[236],!1,0,20)}).mouseout(function(){hideTooltip()}),a(".arrowchat_emoji_flags",n).mouseover(function(){showTooltip(a(this),lang[237],!1,0,20)}).mouseout(function(){hideTooltip()}),a(".arrowchat_emoji_custom",n).mouseover(function(){showTooltip(a(this),lang[238],!1,0,20)}).mouseout(function(){hideTooltip()}),a(".arrowchat_smiley_button",n).mouseenter(function(){a(".arrowchat_smiley_popout",n).children(".arrowchat_more_popout").is(":visible")||showTooltip(a(this),lang[307],0,10,10),a(this).addClass("arrowchat_smiley_button_hover")}),a(".arrowchat_smiley_button",n).mouseleave(function(){hideTooltip(),a(this).removeClass("arrowchat_smiley_button_hover")}),a(".arrowchat_smiley_button",n).click(function(){hideTooltip(),a(".arrowchat_smiley_popout",n).children(".arrowchat_more_popout").is(":visible")?a(".arrowchat_smiley_popout",n).children(".arrowchat_more_popout").hide():(a(".arrowchat_emoji_selector",n).hasClass("arrowchat_emoji_focused")||(a(".arrowchat_emoji_wrapper",n).html('<div class="arrowchat_loading_icon"></div>'),a(".arrowchat_emoji_selector",n).removeClass("arrowchat_emoji_focused"),a(".arrowchat_emoji_smileys",n).addClass("arrowchat_emoji_focused"),a.ajax({url:c_ac_path+"includes/emojis/emoji_smileys.php",type:"GET",cache:!0,success:function(t){a(".arrowchat_emoji_wrapper",n).html(t),a(".arrowchat_emoji",n).click(function(){if(a(this).hasClass("arrowchat_emoji_custom"))var t=a(this).children("img").attr("data-id");else var t=a(this).html();var r=a(".arrowchat_textarea",n).val();a(".arrowchat_textarea",n).focus().val("").val(r+t)})}})),a(".arrowchat_textarea",n).focus(),a(".arrowchat_smiley_popout",n).children(".arrowchat_more_popout").show())}).children().not("i").click(function(t){return!1}),a("body").click(function(t){a(t.target).closest(".arrowchat_smiley_button").length||a(".arrowchat_smiley_popout .arrowchat_more_popout").hide()}),a(".arrowchat_more_options_button",n).mouseenter(function(){a(".arrowchat_more_user_popout_wrapper",n).children(".arrowchat_more_popout").is(":visible")||a(".arrowchat_giphy_popout",n).children(".arrowchat_more_popout").is(":visible")||showTooltip(a(this),lang[308],0,10,10),a(this).addClass("arrowchat_more_options_button_hover")}),a(".arrowchat_more_options_button",n).mouseleave(function(){hideTooltip(),a(this).removeClass("arrowchat_more_options_button_hover")}),a(".arrowchat_more_options_button",n).click(function(){hideTooltip(),a(".arrowchat_more_user_popout_wrapper .arrowchat_more_popout",n).toggle()}).children().not("i").find("input").not().click(function(t){return!1}),a("body").click(function(t){a(t.target).closest(".arrowchat_more_options_button").length||a(".arrowchat_more_user_popout_wrapper .arrowchat_more_popout").hide()}),a(".arrowchat_user_send_button",n).mouseenter(function(){showTooltip(a(this),lang[311],0,10,10),a(this).addClass("arrowchat_user_send_button_hover")}),a(".arrowchat_user_send_button",n).mouseleave(function(){hideTooltip(),a(this).removeClass("arrowchat_user_send_button_hover")}),a(".arrowchat_giphy_button",n).mouseenter(function(){a(this).addClass("arrowchat_giphy_button_hover")}),a(".arrowchat_giphy_button",n).mouseleave(function(){a(this).removeClass("arrowchat_giphy_button_hover")}),a(".arrowchat_gif_button",n).click(function(){var r=1;o&&(r=2),hideTooltip(),a(".arrowchat_more_user_popout_wrapper .arrowchat_more_popout",n).hide(),a(".arrowchat_giphy_popout",n).children(".arrowchat_more_popout").show(),a(".arrowchat_giphy_search",n).val(""),a(".arrowchat_giphy_search",n).focus(),loadGiphy("https://api.giphy.com/v1/gifs/trending?api_key=IOYyr4NK5ldaU&limit=20",r,t)}),a("body").click(function(t){a(t.target).closest(".arrowchat_gif_button",n).length||a(".arrowchat_giphy_popout",n).children(".arrowchat_more_popout").hide()}),a(".arrowchat_giphy_search",n).keyup(function(){var r=1;o&&(r=2),a(".arrowchat_giphy_image_wrapper",n).html('<div class="arrowchat_loading_icon"></div>'),""==a(".arrowchat_giphy_search",n).val()?loadGiphy("https://api.giphy.com/v1/gifs/trending?api_key=IOYyr4NK5ldaU&limit=20",r,t):loadGiphy("https://api.giphy.com/v1/gifs/search?api_key=IOYyr4NK5ldaU&limit=20&q="+a(".arrowchat_giphy_search",n).val(),r,t)}),(1!=c_file_transfer&&!o||1!=c_chatroom_transfer&&o)&&a(".arrowchat_attach_button",n).parent().hide(),1==c_disable_smilies&&(a(".arrowchat_smiley_button").hide(),a(".arrowchat_tabcontentinput",n).addClass("arrowchat_no_smiley")),(1==c_giphy&&!o||1==c_giphy_chatroom&&o)&&a(".arrowchat_gif_button",n).hide(),(1==c_giphy&&1!=c_file_transfer&&!o||1==c_giphy_chatroom&&1!=c_chatroom_transfer&&o)&&a(".arrowchat_tabcontentinput",n).addClass("arrowchat_no_more_actions"),a("body").click(function(t){a(t.target).closest(a(".arrowchat_more_anchor",n)).length||(a(".arrowchat_more_popout_user",n).hide(),a(".arrowchat_more_anchor",n).removeClass("arrowchat_more_button_selected"))}),a(".arrowchat_tabtitle .arrowchat_dash_button",n).mouseenter(function(){showTooltip(a(this),lang[304],0,10,0),a(this).addClass("arrowchat_dash_button_hover")}),a(".arrowchat_tabtitle .arrowchat_dash_button",n).mouseleave(function(){hideTooltip(),a(this).removeClass("arrowchat_dash_button_hover")}),a(".arrowchat_tabtitle .arrowchat_dash_button",n).click(function(){hideTooltip(),a(this).removeClass("arrowchat_dash_button_hover"),s.click()}),a(".arrowchat_textarea",n).keydown(function(r){return o?chatroomKeydown(r,a(this),t):userchatKeydown(r,a(this),t)}),a(".arrowchat_textarea",n).keyup(function(r){return o?chatroomKeyup(r,a(this),t):userchatKeyup(r,a(this),t)}),a(".arrowchat_tabtitle .arrowchat_closebox",n).mouseenter(function(){showTooltip(a(this),lang[89],0,10,0),a(this).addClass("arrowchat_chatboxmouseoverclose"),a(".arrowchat_tabtitle",n).removeClass("arrowchat_chatboxtabtitlemouseover")}),a(".arrowchat_tabtitle .arrowchat_closebox",n).mouseleave(function(){a(this).removeClass("arrowchat_chatboxmouseoverclose"),a(".arrowchat_tabtitle",n).addClass("arrowchat_chatboxtabtitlemouseover"),hideTooltip()}),a(".arrowchat_tabtitle .arrowchat_closebox",n).click(function(){hideTooltip(),o?leaveChatroom(t):leavechat(t)}),a(".arrowchat_more_popout .arrowchat_chat_popout",n).click(function(){a(".arrowchat_more_popout_user",n).toggle(),a(".arrowchat_more_anchor",n).toggleClass("arrowchat_more_button_selected")}),a(".arrowchat_more_popout .arrowchat_chat_popout",n).click(function(){o?window.open(c_ac_path+"public/popout/?cid="+t+"&ah=1","chatroom"+t,"menubar=0,resizable=0,width=940,height=620,top=25,left=25,scrollbars=0,status=0"):window.open(c_ac_path+"public/popout/","user"+t,"menubar=0,resizable=0,width=940,height=620,top=25,left=25,scrollbars=0,status=0")}),a(".arrowchat_tabtitle",n).mouseenter(function(){a(this).addClass("arrowchat_chatboxtabtitlemouseover")}),a(".arrowchat_tabtitle",n).mouseleave(function(){a(this).removeClass("arrowchat_chatboxtabtitlemouseover")}),s.mouseenter(function(){a(this).addClass("arrowchat_tabmouseover"),a("div",s).addClass("arrowchat_tabmouseovertext"),a(".arrowchat_tab_flyout",s).show()}),s.mouseleave(function(){a(this).removeClass("arrowchat_tabmouseover"),a("div",s).removeClass("arrowchat_tabmouseovertext"),a(".arrowchat_tab_flyout",s).hide()}),o?chatroomsSpecialTabProcessing(t,e,r):usersSpecialTabProcessing(t,r),(1==c_disable_avatars||a("#arrowchat_setting_names_only :input").is(":checked"))&&setAvatarVisibility(1)}}function getRandomColor(a){let t=a.slice(0,2).toLowerCase(),r=t.charCodeAt(0);var o=Math.round(16777215*parseInt(r.toString()+r.toString()+r.toString()));return{color:"rgb("+(o>>16&255)+", "+(o>>8&255)+", "+(255&o)+", 0.7)",character:t.toUpperCase()}}function usersSpecialTabProcessing(t,r){a(".arrowchat_user_send_button",$user_popups[t]).click(function(){hideTooltip(),sendUserMessage(a(".arrowchat_textarea",$user_popups[t]),t)}),1!=c_video_chat&&a(".arrowchat_video_icon",$user_popups[t]).hide(),1!=c_enable_moderation&&a(".arrowchat_report_user",$user_popups[t]).parent().hide(),a(".arrowchat_more_anchor",$user_popups[t]).click(function(){hideTooltip(),a(".arrowchat_more_popout_user",$user_popups[t]).toggle(),a(this).toggleClass("arrowchat_more_button_selected")}),addHover(a(".arrowchat_user_image",$user_popups[t]),"arrowchat_user_image_hover"),"offline"==uc_status[t]||"busy"==uc_status[t]&&2!=c_video_select&&3!=c_video_select?a(".arrowchat_tabtitle .arrowchat_video_icon",$user_popups[t]).addClass("arrowchat_video_unavailable"):a(".arrowchat_tabtitle .arrowchat_video_icon",$user_popups[t]).removeClass("arrowchat_video_unavailable"),a(".arrowchat_video_icon",$user_popups[t]).click(function(){if("offline"!=uc_status[t]&&("busy"!=uc_status[t]||2==c_video_select||3==c_video_select)){for(var r=Math.floor(9999999999*Math.random());String(r).length<10;)r="0"+r;(4==c_video_select||1==c_video_select)&&(r=encodeURI(location.host).replace(/\./g,"")+r),2==c_video_select?a.ajax({type:"post",url:c_ac_path+"public/video/video_session.php",data:{room:r},async:!1,success:function(r){a.post(c_ac_path+"includes/json/send/send_message.php",{userid:u_id,to:t,message:"video{"+r+"}"},function(o){a.isNumeric(o)?(jqac.arrowchat.videoWith(r),displayMessage(a(".arrowchat_message_box",$user_popups[t]),lang[63],"notice")):a.each(o,function(r,o){"error"==r&&a.each(o,function(r,o){displayMessage(a(".arrowchat_message_box",$user_popups[t]),o.m,"error")})}),a(".arrowchat_tabcontenttext",$user_popups[t]).scrollTop(a(".arrowchat_tabcontenttext",$user_popups[t])[0].scrollHeight)})}}):a.post(c_ac_path+"includes/json/send/send_message.php",{userid:u_id,to:t,message:"video{"+r+"}"},function(o){a.isNumeric(o)?(jqac.arrowchat.videoWith(r),displayMessage(a(".arrowchat_message_box",$user_popups[t]),lang[63],"notice")):a.each(o,function(r,o){"error"==r&&a.each(o,function(r,o){displayMessage(a(".arrowchat_message_box",$user_popups[t]),o.m,"error")})}),a(".arrowchat_tabcontenttext",$user_popups[t]).scrollTop(a(".arrowchat_tabcontenttext",$user_popups[t])[0].scrollHeight)})}}),a(".arrowchat_block_user",$user_popups[t]).click(function(){a(".arrowchat_more_popout_user",$user_popups[t]).toggle(),a(".arrowchat_more_anchor",$user_popups[t]).toggleClass("arrowchat_more_button_selected"),a(".arrowchat_tabtitle .arrowchat_closebox",$user_popups[t]).click(),a.post(c_ac_path+"includes/json/send/send_settings.php",{block_chat:t},function(){void 0===blockList[t]&&(blockList[t]=t),loadBuddyList()})}),a(".arrowchat_clear_user",$user_popups[t]).click(function(){a(".arrowchat_more_popout_user",$user_popups[t]).toggle(),a(".arrowchat_more_anchor",$user_popups[t]).toggleClass("arrowchat_more_button_selected"),a(".arrowchat_tabcontenttext",$user_popups[t]).html(""),a.post(c_ac_path+"includes/json/send/send_settings.php",{clear_chat:t},function(){})}),a(".arrowchat_report_user",$user_popups[t]).click(function(){a(".arrowchat_more_popout_user",$user_popups[t]).toggle(),a(".arrowchat_more_anchor",$user_popups[t]).toggleClass("arrowchat_more_button_selected"),a.post(c_ac_path+"includes/json/send/send_settings.php",{report_from:u_id,report_about:t},function(){displayMessage(a(".arrowchat_message_box",$user_popups[t]),lang[168],"notice")})}),a(".arrowchat_tabtitle .arrowchat_video_icon",$user_popups[t]).mouseenter(function(){"offline"==uc_status[t]||"busy"==uc_status[t]&&2!=c_video_select&&3!=c_video_select?showTooltip(a(this),lang[146],0,10,0):(showTooltip(a(this),lang[88],0,10,0),a(this).addClass("arrowchat_video_icon_hover")),a(".arrowchat_tabtitle",$user_popups[t]).removeClass("arrowchat_chatboxtabtitlemouseover")}),a(".arrowchat_tabtitle .arrowchat_video_icon",$user_popups[t]).mouseleave(function(){a(this).removeClass("arrowchat_video_icon_hover"),a(".arrowchat_tabtitle",$user_popups[t]).addClass("arrowchat_chatboxtabtitlemouseover"),hideTooltip()}),$users[t].click(function(){lsClick(" ","ac_openclose","users['"+t+"']");var r=0;a(".arrowchat_tabalert",$users[t]).length>0&&(r=1,a(".arrowchat_tabalert",$users[t]).remove(),$users[t].removeClass("arrowchat_tab_new_message"),G[t]=0,y[t]=0),a(this).hasClass("arrowchat_tabclick")?($users[t].detach(),$users[t].prependTo($closed_windows),a(this).show(),closePopup($user_popups[t],a(this)),j="",a.post(c_ac_path+"includes/json/send/send_settings.php",{unfocus_chat:t,tab_alert:1},function(){})):($user_popups[t].detach(),$user_popups[t].prependTo($open_windows),a(this).hide(),1!=ca[t]&&(receiveHistory(t),ca[t]=1),void 0===init_open[t]&&(init_open[t]=1),1==init_open[t]&&a.post(c_ac_path+"includes/json/send/send_settings.php",{focus_chat:t,tab_alert:r},function(){}),init_open[t]=1,a(this).addClass("arrowchat_tabclick").addClass("arrowchat_usertabclick"),$user_popups[t].addClass("arrowchat_tabopen"),j=t),adjustSizes(),a(".arrowchat_tabcontenttext",$user_popups[t]).scrollTop(a(".arrowchat_tabcontenttext",$user_popups[t])[0].scrollHeight),1!=getStatus("updatingsession")&&a(".arrowchat_textarea",$user_popups[t]).focus()}),1!=r&&$users[t].click(),1==c_file_transfer&&userUploadProcessing(t),y[t]=0,G[t]=0}function chatroomsSpecialTabProcessing(t,r,o){1!=c_popout_on&&(a(".arrowchat_chat_popout").parent().hide(),a(".arrowchat_more_popout_user ul .arrowchat_menu_separator:last").hide()),a(".arrowchat_user_send_button",$chatrooms_popups[t]).click(function(){hideTooltip(),sendChatroomMessage(a(".arrowchat_textarea",$chatrooms_popups[t]),t)}),a(".arrowchat_more_anchor",$chatrooms_popups[t]).click(function(){hideTooltip(),a(".arrowchat_more_popout_user",$chatrooms_popups[t]).toggle(),a(this).toggleClass("arrowchat_more_button_selected"),a(".arrowchat_inner_menu",$chatrooms_popups[t]).show(),a(".arrowchat_flood_menu",$chatrooms_popups[t]).hide()}).parent().children(".arrowchat_more_user_wrapper").click(function(){return!1}),1==u_chatroom_sound?a(".arrowchat_room_sounds .arrowchat_switch :input",$chatrooms_popups[t]).prop("checked",!0):(a(".arrowchat_room_sounds").addClass("arrowchat_menu_unchecked"),a(".arrowchat_room_sounds .arrowchat_switch :input",$chatrooms_popups[t]).prop("checked",!1)),a(".arrowchat_room_sounds",$chatrooms_popups[t]).click(function(){a(".arrowchat_room_sounds").toggleClass("arrowchat_menu_unchecked"),a(".arrowchat_room_sounds :input",$chatrooms_popups[t]).is(":checked")?(a(".arrowchat_room_sounds :input").prop("checked",!1),_chatroomsound=-1,u_chatroom_sound=0):(a(".arrowchat_room_sounds :input").prop("checked",!0),_chatroomsound=1,u_chatroom_sound=1),a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_sound:_chatroomsound},function(){})}),1==u_chatroom_block_chats?a(".arrowchat_block_private_chats .arrowchat_switch :input",$chatrooms_popups[t]).prop("checked",!0):(a(".arrowchat_block_private_chats").addClass("arrowchat_menu_unchecked"),a(".arrowchat_block_private_chats .arrowchat_switch :input",$chatrooms_popups[t]).prop("checked",!1)),a(".arrowchat_block_private_chats",$chatrooms_popups[t]).click(function(){a(".arrowchat_block_private_chats").toggleClass("arrowchat_menu_unchecked"),a(".arrowchat_block_private_chats :input",$chatrooms_popups[t]).is(":checked")?(a(".arrowchat_block_private_chats :input").prop("checked",!1),_chatroomblock=-1,u_chatroom_block_chats=0):(a(".arrowchat_block_private_chats :input").prop("checked",!0),_chatroomblock=1,u_chatroom_block_chats=1),a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_block_chats:_chatroomblock},function(){})}),a(".arrowchat_room_list_icon",$chatrooms_popups[t]).mouseenter(function(){showTooltip(a(this),lang[312],0,10,0),a(this).addClass("arrowchat_room_list_icon_hover")}),a(".arrowchat_room_list_icon",$chatrooms_popups[t]).mouseleave(function(){hideTooltip(),a(this).removeClass("arrowchat_room_list_icon_hover")}),a(".arrowchat_room_list_icon",$chatrooms_popups[t]).click(function(){a(this).toggleClass("arrowchat_room_list_icon_selected"),a(".arrowchat_room_userlist",$chatrooms_popups[t]).toggleClass("arrowchat_room_userlist_show")}),$chatrooms[t].click(function(){lsClick(" ","ac_openclose","chatrooms['"+t+"']");var o=0;a(".arrowchat_tabalert",$chatrooms[t]).length>0&&(o=1,a(".arrowchat_tabalert",$chatrooms[t]).remove(),$chatrooms[t].removeClass("arrowchat_tab_new_message")),a(this).hasClass("arrowchat_tabclick")?($chatrooms[t].detach(),$chatrooms[t].prependTo($closed_windows),a(this).show(),closePopup($chatrooms_popups[t],a(this)),a.post(c_ac_path+"includes/json/send/send_settings.php",{unfocus_chat:"r"+t},function(){})):($chatrooms_popups[t].detach(),$chatrooms_popups[t].prependTo($open_windows),a(this).hide(),a(this).addClass("arrowchat_tabclick").addClass("arrowchat_usertabclick"),$chatrooms_popups[t].addClass("arrowchat_tabopen"),void 0===init_open_room[t]&&(init_open_room[t]=1),1==init_open_room[t]&&a.post(c_ac_path+"includes/json/send/send_settings.php",{focus_chat:"r"+t},function(){}),init_open_room[t]=1),adjustSizes(),1!=room_history_loaded[t]&&(initialChatroomLoad(t,r),room_history_loaded[t]=1),a(".arrowchat_tabcontenttext",$chatrooms_popups[t]).scrollTop(a(".arrowchat_tabcontenttext",$chatrooms_popups[t])[0].scrollHeight),a(".arrowchat_textarea",$chatrooms_popups[t]).focus()}),1!=o&&$chatrooms[t].click(),1==c_chatroom_transfer&&chatroomUploadProcessing(t)}function formatTimestamp(a,t){var r="am",o=a.getHours(),e=a.getMinutes(),s=a.getDate();a=a.getMonth();var n=o;o>11&&(r="pm"),o>12&&(o-=12),0==o&&(o=12),e<10&&(e="0"+e);var h=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],l="th";return(1==s||21==s||31==s?l="st":2==s||22==s?l="nd":(3==s||23==s)&&(l="rd"),t)?1!=c_us_time?s!=Na?""+n+":"+e+" "+s+l+" "+h[a]:""+n+":"+e:s!=Na?""+h[a]+" "+s+", "+o+":"+e+r:""+o+":"+e+r:1!=c_us_time?s!=Na?'<span class="arrowchat_ts">'+n+":"+e+" "+s+l+" "+h[a]+"</span>":'<span class="arrowchat_ts">'+n+":"+e+"</span>":s!=Na?'<span class="arrowchat_ts">'+h[a]+" "+s+", "+o+":"+e+r+"</span>":'<span class="arrowchat_ts">'+o+":"+e+r+"</span>"}function receiveHistory(t,r){r||(r=1),r>1&&a('<div class="arrowchat_message_history_loading" style="text-align:center;padding:5px 0;"><img src="'+c_ac_path+"themes/"+u_theme+'/images/img-loading.gif" alt="Loading" /></div>').prependTo(a(".arrowchat_tabcontenttext",$user_popups[t])),a.ajax({cache:!1,url:c_ac_path+"includes/json/receive/receive_history.php",data:{chatbox:t,history:r},type:"post",dataType:"json",success:function(o){if(a(".arrowchat_message_history_loading").remove(),history_ids[t]=0,numMessages=0,o){1==r&&a(".arrowchat_tabcontenttext",$user_popups[t]).html(""),last_sent[t]=null;var e="",s=uc_name[t],n=!1,h=[];a.each(o,function(r,o){"messages"==r&&a.each(o,function(r,o){numMessages++,r="";var l="";1==o.self?(fromname=u_name,fromid=u_id,r=" arrowchat_self",_aa5=_aa4="",avatar=u_avatar,l="<div class='arrowchat_pending_icon arrowchat_pending_delivered'></div>"):(fromname=s,fromid=t,_aa4='<a href="'+uc_link[t]+'">',_aa5="</a>",avatar=uc_avatar[o.from]),last_name[o.from]!=fromid&&void 0!==last_name[o.from]&&h.push(last_id[o.from]);var d="",w="",m=new Date(1e3*o.sent);tooltip=formatTimestamp(m,1),"1"!=c_show_full_name&&-1!=fromname.indexOf(" ")&&(fromname=fromname.slice(0,fromname.indexOf(" "))),"<div"==o.message.substr(0,4)&&(d=" arrowchat_image_msg"),(null==last_sent[o.from]||o.sent-last_sent[o.from]>180)&&(w=" arrowchat_show_time");var u=getRandomColor(fromname);e+='<div class="arrowchat_chatboxmessage arrowchat_clearfix'+r+d+w+'" id="arrowchat_message_'+o.id+'">'+formatTimestamp(m)+'<div class="arrowchat_chatboxmessagefrom arrowchat_single_avatar_hide arrowchat_white_background" style="background-color:'+u.color+'"><span class="arrowchat_tab_letter arrowchat_tab_letter_xsmall">'+u.character+'</span><img alt="'+fromname+'" class="arrowchat_chatbox_avatar" src="'+avatar+'" /></div><div class="arrowchat_chatboxmessage_wrapper"><div class="arrowchat_chatboxmessagecontent" data-id="'+tooltip+'">'+o.message+"</div></div>"+l+"</div>",last_sent[o.from]=o.sent,last_name[o.from]=fromid,last_id[o.from]=o.id,n=!0})});var l=a(".arrowchat_tabcontenttext",$user_popups[t]).children("div").first("div");r>1?a(e).prependTo(a(".arrowchat_tabcontenttext",$user_popups[t]).first("div")):a(".arrowchat_tabcontenttext",$user_popups[t]).html("<div>"+e+"</div>"),a("#arrowchat_message_"+last_id[t]).length&&a("#arrowchat_message_"+last_id[t]).children(".arrowchat_chatboxmessagefrom").removeClass("arrowchat_single_avatar_hide"),a.each(h,function(t,r){a("#arrowchat_message_"+r).length&&a("#arrowchat_message_"+r).children(".arrowchat_chatboxmessagefrom").removeClass("arrowchat_single_avatar_hide")}),a(".arrowchat_pending_icon:not(.arrowchat_pending_error)",$user_popups[t]).hide(),a(".arrowchat_tabcontenttext div .arrowchat_pending_icon:last",$user_popups[t]).show(),showTimeAndTooltip(),(1==c_disable_avatars||a("#arrowchat_setting_names_only :input").is(":checked"))&&setAvatarVisibility(1);var d=0;l.prevAll().each(function(){d+=a(this).outerHeight()}),1==r?a(".arrowchat_tabcontenttext",$user_popups[t]).scrollTop(5e4):a(".arrowchat_tabcontenttext",$user_popups[t]).scrollTop(d),a(".arrowchat_tabcontenttext",$user_popups[t]).scroll(function(){50>a(".arrowchat_tabcontenttext",$user_popups[t]).scrollTop()&&1!=history_ids[t]&&(history_ids[t]=1,20==numMessages&&receiveHistory(t,++r))}),preventScrolling(a(".arrowchat_tabcontenttext")),0==numMessages&&1==r&&(a(".arrowchat_tabcontenttext",$user_popups[t]).html('<div class="arrowchat_no_recent_convo"><i class="fas fa-hand-wave"></i>'+lang[245]+"</p>"),a(".arrowchat_tabcontenttext",$user_popups[t]).html('<div class="arrowchat_no_recent_convo"><i class="fas fa-hand-wave"></i>'+lang[245]+"</p>")),1==r&&a(".arrowchat_image_msg img,.arrowchat_emoji_text img").one("load",function(){a(".arrowchat_tabcontenttext",$user_popups[t]).scrollTop(5e4)}).each(function(){this.complete&&a(this).trigger("load")})}}})}function showTimeAndTooltip(){a(".arrowchat_chatboxmessagecontent").mouseenter(function(){a(this).parent().parent().hasClass("arrowchat_image_msg")?showTooltip(a(this),a(this).attr("data-id"),!1,a(this).parent().width()+23,6,1,!1):showTooltip(a(this),a(this).attr("data-id"),!1,a(this).parent().width()-5,-3,1,!1)}),a(".arrowchat_chatboxmessagecontent").mouseleave(function(){hideTooltip()}),a(".arrowchat_chatboxmessage").mouseenter(function(){a(this).children(".arrowchat_ts").show()}),a(".arrowchat_chatboxmessage").mouseleave(function(){a(this).children(".arrowchat_ts").hide()}),a(".arrowchat_lightbox").unbind("click"),a(".arrowchat_lightbox").click(function(){a.slimbox(a(this).attr("data-id"),'<a href="'+a(this).attr("data-id")+'">'+lang[70]+"</a>",{resizeDuration:1,overlayFadeDuration:1,imageFadeDuration:1,captionAnimationDuration:1})})}function showChatroomTime(){a(".arrowchat_chatroom_msg:not(.arrowchat_global_chatroom_message)").unbind("mouseenter"),a(".arrowchat_chatroom_msg:not(.arrowchat_global_chatroom_message)").mouseenter(function(t){a(this).parents(".arrowchat_chatroom_box_message").hasClass("arrowchat_image_msg")?showTooltip(a(this),a(this).parent().attr("data-id"),!1,a(this).parent().width()+23,6,1,!1):showTooltip(a(this),a(this).parent().attr("data-id"),!1,a(this).parent().width()-5,-3,1,!1),a(this).parents(".arrowchat_chatroom_box_message").hasClass("arrowchat_self")||a(this).parents(".arrowchat_chatroom_msg_wrap").find(".arrowchat_message_controls").addClass("arrowchat_message_controls_display")}),a(".arrowchat_chatroom_msg:not(.arrowchat_global_chatroom_message)").unbind("mouseleave"),a(".arrowchat_chatroom_msg:not(.arrowchat_global_chatroom_message)").mouseleave(function(t){a(t.toElement).hasClass("arrowchat_message_controls")||(hideTooltip(),a(".arrowchat_message_controls").removeClass("arrowchat_message_controls_display"))}),a(".arrowchat_message_controls").unbind("mouseleave"),a(".arrowchat_message_controls").mouseleave(function(t){a(t.toElement).hasClass("arrowchat_chatroom_msg")||(hideTooltip(),a(".arrowchat_message_controls").removeClass("arrowchat_message_controls_display"))}),a(".arrowchat_chatroom_reply").unbind("mouseenter").unbind("mouseleave").unbind("click"),a(".arrowchat_chatroom_reply").mouseenter(function(){showTooltip(a(this),lang[313],0,10,10),a(this).addClass("arrowchat_chatroom_reply_hover")}),a(".arrowchat_chatroom_reply").mouseleave(function(){hideTooltip(),a(this).removeClass("arrowchat_chatroom_reply_hover")}),a(".arrowchat_chatroom_reply").click(function(){hideTooltip(),a(".arrowchat_message_controls").removeClass("arrowchat_message_controls_display");var t=a(this).parents(".arrowchat_tabpopup").attr("data-room-id"),r=a(this).parents(".arrowchat_chatroom_box_message").find(".arrowchat_chatroom_message_avatar").attr("alt");":"==r.charAt(r.length-1)&&(r=r.substring(0,r.length-1));var o="@"+r+" ",e=a(".arrowchat_textarea",$chatrooms_popups[t]).val();""!=e&&" "!=e.charAt(e.length-1)&&(o=" "+o),a(".arrowchat_textarea",$chatrooms_popups[t]).focus().val("").val(e+o)}),a(".arrowchat_lightbox").unbind("click"),a(".arrowchat_lightbox").click(function(){a.slimbox(a(this).attr("data-id"),'<a href="'+a(this).attr("data-id")+'">'+lang[70]+"</a>",{resizeDuration:1,overlayFadeDuration:1,imageFadeDuration:1,captionAnimationDuration:1})})}function setAvatarVisibility(t){1==t?(a(".arrowchat_closed_windows_wrapper[data-id] .arrowchat_closed_image img").addClass("arrowchat_hide_avatars"),a(".arrowchat_tabpopup[data-id] .arrowchat_avatarbox img").addClass("arrowchat_hide_avatars"),a(".arrowchat_tab_letter").css("display","flex"),a(".arrowchat_userlist_avatar").addClass("arrowchat_hide_avatars"),a(".arrowchat_chatroom_avatar").addClass("arrowchat_hide_avatars"),a(".arrowchat_chatroom_flyout_avatar").addClass("arrowchat_hide_avatars"),a(".arrowchat_chatroom_message_avatar").addClass("arrowchat_hide_avatars"),a(".arrowchat_chatbox_avatar").addClass("arrowchat_hide_avatars"),a(".arrowchat_closed_windows_wrapper[data-id] .arrowchat_closed_image").removeClass("arrowchat_white_background"),a(".arrowchat_chatboxmessagefrom").removeClass("arrowchat_white_background"),a(".arrowchat_avatarbox").removeClass("arrowchat_white_background"),a(".arrowchat_chatbox_avatar_wrapper").removeClass("arrowchat_white_background"),a(".arrowchat_disable_avatars_name").show(),a(".arrowchat_chatboxmessage_wrapper").addClass("arrowchat_chatboxmessage_wrapper2"),a(".arrowchat_chatboxmessagecontent").addClass("arrowchat_chatboxmessagecontent2")):(a(".arrowchat_closed_windows_wrapper[data-id] .arrowchat_closed_image img").removeClass("arrowchat_hide_avatars"),a(".arrowchat_tabpopup[data-id] .arrowchat_avatarbox img").removeClass("arrowchat_hide_avatars"),a(".arrowchat_tab_letter").hide(),a(".arrowchat_userlist_avatar").removeClass("arrowchat_hide_avatars"),a(".arrowchat_chatroom_avatar").removeClass("arrowchat_hide_avatars"),a(".arrowchat_chatroom_flyout_avatar").removeClass("arrowchat_hide_avatars"),a(".arrowchat_chatroom_message_avatar").removeClass("arrowchat_hide_avatars"),a(".arrowchat_chatbox_avatar").removeClass("arrowchat_hide_avatars"),a(".arrowchat_closed_windows_wrapper[data-id] .arrowchat_closed_image").addClass("arrowchat_white_background"),a(".arrowchat_chatboxmessagefrom").addClass("arrowchat_white_background"),a(".arrowchat_avatarbox").addClass("arrowchat_white_background"),a(".arrowchat_chatbox_avatar_wrapper").addClass("arrowchat_white_background"),a(".arrowchat_disable_avatars_name").hide(),a(".arrowchat_chatboxmessage_wrapper").removeClass("arrowchat_chatboxmessage_wrapper2"),a(".arrowchat_chatboxmessagecontent").removeClass("arrowchat_chatboxmessagecontent2"))}function buildBuddyListTab(){var t="";if($buddy_list_tab=a("<div/>").attr("id","arrowchat_buddy_list_tab").html(ArrowChat.Templates.buddylist_tab()).appendTo($base),$open_windows=a("<div/>").attr("id","arrowchat_open_windows").appendTo($base),$closed_windows=a("<div/>").attr("id","arrowchat_closed_windows").appendTo($base),$userstab_popup=a("<div/>").attr("id","arrowchat_userstab_popup").addClass("arrowchat_tabpopup").html(ArrowChat.Templates.buddylist_window(t,acp)).appendTo($open_windows),1==c_disable_avatars&&(a("#arrowchat_name_box").hide(),a("#arrowchat_setting_names_only").parent("li").hide()),a(".arrowchat_powered_by").css("display","none"),a(".arrowchat_search_friends_text").placeholder(),1==u_sounds?a("#arrowchat_setting_sound .arrowchat_switch :input").prop("checked",!0):(a("#arrowchat_setting_sound").addClass("arrowchat_menu_unchecked"),a("#arrowchat_setting_sound .arrowchat_switch :input").prop("checked",!1)),1==u_blist_open?a("#arrowchat_setting_window_open .arrowchat_switch :input").prop("checked",!0):(a("#arrowchat_setting_window_open").addClass("arrowchat_menu_unchecked"),a("#arrowchat_setting_window_open .arrowchat_switch :input").prop("checked",!1)),1==u_no_avatars?a("#arrowchat_setting_names_only .arrowchat_switch :input").prop("checked",!0):(a("#arrowchat_setting_names_only").addClass("arrowchat_menu_unchecked"),a("#arrowchat_setting_names_only .arrowchat_switch :input").prop("checked",!1)),1==u_is_guest&&1==c_guest_name_change&&""==u_guest_name){function r(){var t=a(".arrowchat_guest_name_input").val();a.post(c_ac_path+"includes/json/send/send_settings.php",{chat_name:t},function(r){"1"!=r?r==lang[123]?(displayMessage(a("#arrowchat_buddylist_message_flyout"),r,"error"),a(".arrowchat_enter_name_wrapper").fadeOut("fast")):displayMessage(a("#arrowchat_buddylist_message_flyout"),r,"error"):(a(".arrowchat_enter_name_wrapper").fadeOut("fast"),u_name=t)})}a(".arrowchat_enter_name_wrapper").show(),a(".arrowchat_guest_name_input").placeholder(),a(".arrowchat_guest_name_input").keydown(function(t){13==t.keyCode&&r()}),a("#arrowchat_guest_name_button").click(function(){r()})}a(".arrowchat_search_friends_text").keyup(function(){void 0!==searchxhr&&searchxhr.abort(),a(".arrowchat_search_not_found").remove(),a("#arrowchat_userscontent").children("div").not(".arrowchat_userslist_offline").hide(),a("<div/>").attr("class","arrowchat_search_not_found arrowchat_nofriends").html('<div class="arrowchat_loading_icon"></div>').prependTo("#arrowchat_userscontent"),clearTimeout(Z),adjustSizes();var t=0,r="",o="",e=a(this).val();e.length<2?(a(".arrowchat_search_not_found").remove(),a("#arrowchat_userscontent").children("div").not("#arrowchat_userslist_offline").show(),2==buddylisttest&&loadBuddyList(),buddylisttest=1):(buddylisttest=2,a("#arrowchat_setting_names_only :input").is(":checked")&&(o="arrowchat_hide_avatars"),searchxhr=a.ajax({url:c_ac_path+"includes/json/receive/receive_search.php",type:"post",cache:!1,dataType:"json",data:{search_name:e},success:function(e){e&&null!=e&&(a.each(e,function(e,s){a.each(s,function(e,s){if(void 0!==uc_avatar[s.id])var n=uc_avatar[s.id];else var n=s.avatar;var h=" fas fa-circle";"away"==s.status?h=" fas fa-moon":"busy"==s.status&&(h=" far fa-mobile-screen"),(1==c_disable_avatars||a("#arrowchat_setting_names_only :input").is(":checked"))&&(o="arrowchat_hide_avatars"),r+='<div id="arrowchat_userlist_'+s.id+'" class="arrowchat_userlist" onmouseover="jqac(this).addClass(\'arrowchat_userlist_hover\');" onmouseout="jqac(this).removeClass(\'arrowchat_userlist_hover\');"><img class="arrowchat_userlist_avatar '+o+'" src="'+n+'" /><span class="arrowchat_userscontentname">'+s.name+'</span><span class="arrowchat_userscontentdot arrowchat_'+s.status+h+'"></span></div>',t++})}),0==t?a(".arrowchat_search_not_found").html(lang[26]):(a(".arrowchat_search_not_found").remove(),a("#arrowchat_userslist_available").show().html(r),a(".arrowchat_userlist").click(function(t){receiveUserFromUserlist(t.target)}))),adjustSizes()}})),adjustSizes()}),a(document).bind("idle.idleTimer",function(){1!=w&&(clearUserStatus(),setUserStatus("away"),isAway=1)}),a(document).bind("active.idleTimer",function(){1!=w&&(clearUserStatus(),setUserStatus("available"),isAway=0)}),a.idleTimer(6e4*ArrowChat.IdleTime),a("#arrowchat_setting_sound").click(function(){lsClick("#arrowchat_setting_sound","ac_click"),a(this).toggleClass("arrowchat_menu_unchecked"),a("#arrowchat_setting_sound :input").is(":checked")?(a("#arrowchat_setting_sound :input").prop("checked",!1),_soundcheck=-1,u_sounds=0):(a("#arrowchat_setting_sound :input").prop("checked",!0),_soundcheck=1,u_sounds=1),a.post(c_ac_path+"includes/json/send/send_settings.php",{sound:_soundcheck},function(){})}),a("#arrowchat_setting_window_open").click(function(){a(this).toggleClass("arrowchat_menu_unchecked"),a("#arrowchat_setting_window_open :input").is(":checked")?(a("#arrowchat_setting_window_open :input").prop("checked",!1),_windowcheck=-1):(a("#arrowchat_setting_window_open :input").prop("checked",!0),_windowcheck=1),a.post(c_ac_path+"includes/json/send/send_settings.php",{window:_windowcheck},function(){})}),a("#arrowchat_setting_names_only").click(function(){lsClick("#arrowchat_setting_names_only","ac_click"),a(this).toggleClass("arrowchat_menu_unchecked"),a("#arrowchat_setting_names_only :input").is(":checked")?(a("#arrowchat_setting_names_only :input").prop("checked",!1),setAvatarVisibility(0),_namecheck=-1):(a("#arrowchat_setting_names_only :input").prop("checked",!0),setAvatarVisibility(1),_namecheck=1),a.post(c_ac_path+"includes/json/send/send_settings.php",{name:_namecheck},function(){})}),a("#arrowchat_setting_block_list").click(function(){a(this).parent().parent(".arrowchat_inner_menu").hide(),a(".arrowchat_block_menu").show(),a.ajax({url:c_ac_path+"includes/json/receive/receive_block_list.php",type:"get",cache:!1,dataType:"json",success:function(t){t&&null!=t&&(a(".arrowchat_block_menu select").html(""),a("<option/>").attr("value","0").html(lang[118]).appendTo(a(".arrowchat_block_menu select")),a.each(t,function(t,r){a.each(r,function(t,r){a("<option/>").attr("value",r.id).html(r.username).appendTo(a(".arrowchat_block_menu select"))})}))}})}),a("#arrowchat_unblock_button").click(function(){a(".arrowchat_more_button").click();var t=a(".arrowchat_block_menu select").val();"0"!=t&&a.post(c_ac_path+"includes/json/send/send_settings.php",{unblock_chat:t},function(){void 0!==blockList[t]&&blockList.splice(t,1),loadBuddyList()})}),preventScrolling(a("#arrowchat_userscontent")),a("#arrowchat_mobiletab").mouseleave(function(){a(this).removeClass("arrowchat_mobiletab_hover")}),a("#arrowchat_mobiletab").mouseenter(function(){a(this).addClass("arrowchat_mobiletab_hover")}),a(".arrowchat_close_button",$userstab_popup).mouseenter(function(){showTooltip(a(this),lang[299],0,10,0),a(this).addClass("arrowchat_close_button_hover")}),a(".arrowchat_close_button",$userstab_popup).mouseleave(function(){hideTooltip(),a(this).removeClass("arrowchat_close_button_hover")}),a(".arrowchat_close_button",$userstab_popup).click(function(){hideTooltip(),$buddy_list_tab.click()}),a("#arrowchat_block_back",$userstab_popup).click(function(){a("#arrowchat_options_flyout .arrowchat_inner_menu",$userstab_popup).show(),a(".arrowchat_block_menu").hide()}),a("#arrowchat_user_selection",$userstab_popup).click(function(){a(this).hasClass("arrowchat_selection_tab_selected")||(a("#arrowchat_userscontent").children("div").not("#arrowchat_userslist_offline").show(),a(".arrowchat_search_friends_text").val(""),a(this).addClass("arrowchat_selection_tab_selected"),a("#arrowchat_room_selection",$userstab_popup).removeClass("arrowchat_selection_tab_selected"),a(".arrowchat_chatroom_full_content").hide(),a("#arrowchat_userscontent").show(),loadBuddyList(),lsClick("#arrowchat_user_selection","ac_click"))}),a(".arrowchat_search_friends_text",$userstab_popup).keydown(function(){a("#arrowchat_user_selection").click()}),a(".arrowchat_more_button").mouseenter(function(){showTooltip(a(this),lang[23],0,10,0),a(this).addClass("arrowchat_more_button_hover")}).children().mouseenter(function(){return!1}),a(".arrowchat_more_button").mouseleave(function(){hideTooltip(),a(this).removeClass("arrowchat_more_button_hover")}).children().mouseleave(function(){return!1}),a(".arrowchat_more_button").click(function(){hideTooltip(),a("#arrowchat_options_flyout").toggleClass("arrowchat_options_flyout_display"),a(this).toggleClass("arrowchat_more_button_selected"),a("#arrowchat_options_flyout").children(".arrowchat_inner_menu").show(),a(".arrowchat_block_menu").hide()}).children().click(function(){return!1}),a("body").click(function(t){a(t.target).closest(".arrowchat_more_button").length||a("#arrowchat_options_flyout").removeClass("arrowchat_options_flyout_display")}),addHover(a(".arrowchat_menu_item"),"arrowchat_more_hover"),a("#arrowchat_gooffline").click(function(){lsClick("#arrowchat_gooffline","ac_click"),a(".arrowchat_more_button").click(),pushCancelAll(),cancelJSONP(),a.idleTimer("destroy"),clearTimeout(Z),clearTimeout(Crref2),showUserOffline()}),$buddy_list_tab.mouseover(function(){$userstab_popup.hasClass("arrowchat_tabopen")||(a("#arrowchat_welcome").is(":visible")||showTooltip($buddy_list_tab,lang[306],!1,a(this).width()+25,6,1,!1),a(this).addClass("arrowchat_tabmouseover"))}),$buddy_list_tab.mouseout(function(){a(this).removeClass("arrowchat_tabmouseover"),hideTooltip()}),$buddy_list_tab.click(function(){lsClick("#arrowchat_buddy_list_tab","ac_openclose"),hideTooltip(),(1==w||1==bli)&&(clearTimeout(Z),loadBuddyList(),bli=0),1==c_first_time_message_viewed&&(a("#arrowchat_welcome").hide(),a.post(c_ac_path+"includes/json/send/send_settings.php",{welcome:1},function(){}),c_first_time_message_viewed=0),1==w&&(w=0,a("#arrowchat_mobiletab_count").html(R),receiveCore(),pushSubscribe(),Object.keys($chatrooms).length>0&&receiveChatroom(),a.idleTimer(6e4*ArrowChat.IdleTime),setUserStatus("available"),a("#arrowchat_mobiletab").removeClass("arrowchat_mobiletab_offline"),$open_windows.show(),$closed_windows.show()),$buddy_list_tab.hasClass("arrowchat_tabclick")||($userstab_popup.detach(),$userstab_popup.prependTo($open_windows)),a(this).toggleClass("arrowchat_tabclick").toggleClass("arrowchat_userstabclick"),$userstab_popup.toggleClass("arrowchat_tabopen"),a(".arrowchat_enter_name_wrapper").is(":visible")&&a(".arrowchat_guest_name_input").focus(),adjustSizes()})}function buildUnseenUsers(){($unseen_users=a(ArrowChat.Templates.unseen_chat_tab()).appendTo($closed_windows)).mouseenter(function(){a("#arrowchat_unseen_flyout").show()}),$unseen_users.mouseleave(function(){a("#arrowchat_unseen_flyout").hide()}),preventScrolling(a("#arrowchat_unseen_flyout"))}function adjustClosedWindows(){if(void 0===$closed_windows)return!1;var t=0,r="",o=0;a("#arrowchat_unseen_list").html(""),$closed_windows.children().each(function(e){if(!a(this).hasClass("arrowchat_tabclick")&&!a(this).hasClass("arrowchat_unseen_users_tabs")){var s=0,n="";if(++t>=c_num_closed_windows){a(this).children(".arrowchat_tabalert").length>0&&(s=parseInt(a(this).children(".arrowchat_tabalert").html()))>0&&(n=" arrowchat_show"),o+=s,a(this).hide();var h=a(this).attr("data-id"),l=a(this).attr("data-room-id");void 0!==l&&!1!==l?a("<li/>").attr("data-room-id",l).addClass("arrowchat_unseen_user_list").html("<span>"+cr_name[l]+'</span><div class="arrowchat_unseen_list_count'+n+'">'+s+'</div><div class="arrowchat_unseen_close far fa-xmark"> </div>').appendTo(a("#arrowchat_unseen_list")):a("<li/>").attr("data-id",h).addClass("arrowchat_unseen_user_list").html("<span>"+uc_name[h]+'</span><div class="arrowchat_unseen_list_count'+n+'">'+s+'</div><div class="arrowchat_unseen_close far fa-xmark"> </div>').appendTo(a("#arrowchat_unseen_list"))}else a(this).show();t==c_num_closed_windows&&(r=a(this).children(".arrowchat_closed_image").html())}}),o>0?a(".arrowchat_unseen_tabalert").html(o).show():a(".arrowchat_unseen_tabalert").html("0").hide(),t>=c_num_closed_windows?(a(".arrowchat_unseen_count",$unseen_users).html("+"+(t-(c_num_closed_windows-1))),a(".arrowchat_closed_image",$unseen_users).html(r),a(".arrowchat_unseen_user_list").mouseenter(function(t){t.target==this&&(a(".arrowchat_unseen_user_list").removeClass("arrowchat_unseen_user_list_hover"),a(this).addClass("arrowchat_unseen_user_list_hover"))}),a(".arrowchat_unseen_user_list").mouseleave(function(t){t.target==this&&a(this).removeClass("arrowchat_unseen_user_list_hover")}),a(".arrowchat_unseen_user_list").click(function(t){var r=a(this).attr("data-id"),o=a(this).attr("data-room-id");a(this).removeClass("arrowchat_unseen_user_list_hover"),a("#arrowchat_unseen_flyout").hide(),void 0!==o&&!1!==o?$chatrooms[o].click():$users[r].click()}),a(".arrowchat_unseen_close").mouseenter(function(t){t.target==this&&(a(".arrowchat_unseen_close").removeClass("arrowchat_unseen_close_hover"),a(this).addClass("arrowchat_unseen_close_hover"))}),a(".arrowchat_unseen_close").mouseleave(function(t){t.target==this&&a(this).removeClass("arrowchat_unseen_close_hover")}),a(".arrowchat_unseen_close").click(function(t){var r=a(this).parent().attr("data-id"),o=a(this).parent().attr("data-room-id");a(this).removeClass("arrowchat_unseen_close_hover"),a("#arrowchat_unseen_flyout").hide(),void 0!==o&&!1!==o?a(".arrowchat_closebox_bottom",$chatrooms[o]).click():a(".arrowchat_closebox_bottom",$users[r]).click()}),$unseen_users.show()):$unseen_users.hide()}function adjustChatWindows(){if(void 0===$open_windows)return!1;var t=a("#arrowchat_open_windows").outerWidth(),r=a("#arrowchat_buddy_list_tab").outerWidth(),o=a(window).width();if(c_window_left_padding=parseInt(c_window_left_padding),o-(t+r)<c_window_left_padding){if($open_windows.children(".arrowchat_tabopen").length>1){var e=$open_windows.children(".arrowchat_tabopen").last().attr("data-id"),s=$open_windows.children(".arrowchat_tabopen").last().attr("data-room-id");void 0!==e&&!1!==e&&($users[e].detach(),$users[e].prependTo($closed_windows),$users[e].removeClass("arrowchat_tabclick").removeClass("arrowchat_usertabclick").show()),void 0!==s&&!1!==s&&($chatrooms[s].detach(),$chatrooms[s].prependTo($closed_windows),$chatrooms[s].removeClass("arrowchat_tabclick").removeClass("arrowchat_usertabclick").show()),$open_windows.children(".arrowchat_tabopen").last().removeClass("arrowchat_tabopen").addClass("arrowchat_temporary_hide")}}else if(o-(t+r)>c_window_left_padding+20+a(".arrowchat_tabopen").outerWidth()){var e=$open_windows.children(".arrowchat_temporary_hide").first().attr("data-id"),s=$open_windows.children(".arrowchat_temporary_hide").first().attr("data-room-id");void 0!==e&&!1!==e&&($users[e].addClass("arrowchat_tabclick").addClass("arrowchat_usertabclick").hide(),a(".arrowchat_tabalert",$users[e]).length>0&&(a(".arrowchat_tabalert",$users[e]).remove(),$users[e].removeClass("arrowchat_tab_new_message"),G[e]=0,y[e]=0)),void 0!==s&&!1!==s&&($chatrooms[s].addClass("arrowchat_tabclick").addClass("arrowchat_usertabclick").hide(),a(".arrowchat_tabalert",$chatrooms[s]).length>0&&(a(".arrowchat_tabalert",$chatrooms[s]).remove(),$chatrooms[s].removeClass("arrowchat_tab_new_message"))),$open_windows.children(".arrowchat_temporary_hide").first().addClass("arrowchat_tabopen").removeClass("arrowchat_temporary_hide")}}function adjustSizes(){adjustChatWindows(),adjustClosedWindows()}function set(a,t){V[a]=t}function get(a){return V[a]?V[a]:""}function getStatus(a){return xa[a]?xa[a]:""}function receiveUserFromUserlist(t){if(a(t).attr("id"))var r=a(t).attr("id").substr(19);else var r="";""==r&&(r=a(t).parent().attr("id").substr(19)),receiveUser(r,uc_name[r],uc_status[r],uc_avatar[r],uc_link[r]),lsClick("#arrowchat_userlist_"+r,"ac_click")}function chatroomListClicked(t,r){c="",a(t).attr("id")&&(c=a(t).attr("id").substr(r)),""==c&&(c=a(t).parent().attr("id").substr(r)),2==cr_type[c]?(a("#arrowchat_chatroom_password_id").val(c),a("#arrowchat_chatroom_"+c).hasClass("arrowchat_chatroom_clicked")?(a("#arrowchat_chatroom_password_flyout").hide("slide",{direction:"up"},250),a(".arrowchat_chatroom_list").removeClass("arrowchat_chatroom_clicked"),a(".arrowchat_chatroom_full_content").removeClass("arrowchat_chatroom_opacity")):(a(".arrowchat_chatroom_list").removeClass("arrowchat_chatroom_clicked"),a("#arrowchat_chatroom_"+c).addClass("arrowchat_chatroom_clicked"),a("#arrowchat_chatroom_password_flyout").is(":visible")?(a("#arrowchat_chatroom_password_flyout").hide("slide",{direction:"up"},250),a("#arrowchat_chatroom_password_flyout").show("slide",{direction:"up"},250,function(){a("#arrowchat_chatroom_password_input").focus()}),a(".arrowchat_chatroom_full_content").addClass("arrowchat_chatroom_opacity")):(a("#arrowchat_chatroom_password_flyout").show("slide",{direction:"up"},250,function(){a("#arrowchat_chatroom_password_input").focus()}),a(".arrowchat_chatroom_full_content").addClass("arrowchat_chatroom_opacity")))):(a(".arrowchat_chatroom_full_content").removeClass("arrowchat_chatroom_opacity"),a("#arrowchat_chatroom_password_flyout").is(":visible")&&a("#arrowchat_chatroom_password_flyout").hide("slide",{direction:"up"},250),loadChatroom(c,""))}function addMessageToChatroom(t,r,o,e,s,n){void 0===e&&(e=0);var h="",l="",d="";1==chatroom_mod[s]&&(h=lang[137],l=" arrowchat_chatroom_important"),1==chatroom_admin[s]&&(h=lang[137],l=" arrowchat_chatroom_important"),1!=e&&(o=o.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/\"/g,"&quot;")),"<div"==(o=smileyreplace(o=replaceURLWithHTMLLinks(o=youTubeEmbed(o)))).substr(0,4)&&(d=" arrowchat_image_msg");var w="<div class='arrowchat_pending_icon'></div>";1==e&&(w="<div class='arrowchat_pending_icon arrowchat_pending_delivered'></div>");var m="",u="";0!=n&&(m=" arrowchat_pending_msg",u=" arrowchat_pending_msg_room_"+n);var p=formatTimestamp(new Date(1e3*Math.floor((new Date).getTime()/1e3)),1);if(a("#arrowchat_chatroom_message_"+t).length>0);else{if(0!=t)var v=' id="arrowchat_chatroom_message_'+t+'" ';else var v="";a(".arrowchat_tabcontenttext",$chatrooms_popups[s]).append('<div class="arrowchat_chatroom_box_message arrowchat_self'+l+d+m+u+'" '+v+'><div class="arrowchat_chatroom_message_name"><i class="'+h+'"></i>'+r+'</div><div class="arrowchat_chatroom_msg_wrap"><img class="arrowchat_chatroom_message_avatar arrowchat_no_names" src="'+u_avatar+'" alt="'+r+'" /><div class="arrowchat_chatroom_message_content" data-id="'+p+'"><span class="arrowchat_chatroom_msg">'+o+'</span></div><div class="arrowchat_message_controls"><div class="arrowchat_chatroom_reply"><i class="fas fa-reply"></i></div><div class="arrowchat_chatroom_delete" data-id="'+t+'"><i class="far fa-xmark"></i></div></div></div>'+w+"</div>"),a(".arrowchat_tabcontenttext",$chatrooms_popups[s]).scrollTop(5e4)}0!=s&&(showChatroomTime(),modDeleteControls(s))}function addMessageToContent(t,r){null==uc_name[t]||""==uc_name[t]?setTimeout(function(){addMessageToContent(t,r)},500):(a(".arrowchat_tabcontenttext",$user_popups[t]).append("<div>"+r+"</div>"),a(".arrowchat_tabcontenttext",$user_popups[t]).scrollTop(5e4),G[t]=1)}function loadChatroomList(t,r){void 0===t&&(t=0),void 0===r&&(r=""),a.ajax({url:c_ac_path+"includes/json/receive/receive_chatroom_list.php",cache:!1,type:"post",dataType:"json",success:function(o){buildChatroomList(o),0!=t&&toggleUserChatTab(t,0,!0,r)}})}function buildChatroomList(t){a(".arrowchat_nofriends").remove(),a(".arrowchat_chatroom_full_content").html("");var r="",o="",e=0,s="";t&&a.each(t,function(t,n){"chatrooms"==t&&a.each(n,function(t,n){e++,r='<div id="arrowchat_chatroom_'+n.id+'" class="arrowchat_chatroom_list"><div class="arrowchat_chatroom_image"><img src="'+c_ac_path+"themes/"+u_theme+"/images/icons/"+n.img+'" alt="" /></div><div class="arrowchat_chatroom_name_wrapper"><div class="arrowchat_chatroom_name">'+n.n+'<i class="arrowchat_chatroom_status arrowchat_chatroom_'+n.t+'"></i></div><div class="arrowchat_chatroom_desc">'+n.d+'</div></div><div class="arrowchat_chatroom_status_wrapper"><div class="arrowchat_chatroom_count"><i class="fad fa-circle-user"></i><span>'+n.c+'</span></div></div><div class="arrowchat_clearfix"></div></div>',1==n.o?s+=r:o+=r,cr_name[n.id]=n.n,cr_desc[n.id]=n.d,cr_welcome[n.id]=n.welcome,cr_img[n.id]=n.img,cr_type[n.id]=n.t,cr_count[n.id]=n.c,cr_other[n.id]=n.o})}),0==e&&a('<div class="arrowchat_nofriends">'+lang[318]+"</div>").appendTo(".arrowchat_chatroom_full_content"),""!=o&&(a('<div class="arrowchat_chatroom_list_title">'+lang[227]+"</div>").appendTo(a(".arrowchat_chatroom_full_content")),a(o).appendTo(a(".arrowchat_chatroom_full_content"))),""!=s&&(a('<div class="arrowchat_chatroom_list_title">'+lang[228]+"</div>").appendTo(a(".arrowchat_chatroom_full_content")),a(s).appendTo(a(".arrowchat_chatroom_full_content"))),a(".arrowchat_chatroom_list").mouseover(function(){a(this).addClass("arrowchat_chatroom_list_hover")}).mouseout(function(){a(this).removeClass("arrowchat_chatroom_list_hover")}),a(".arrowchat_chatroom_list").click(function(t){chatroomListClicked(a(this),19)}),a(".arrowchat_chatroom_count").mouseenter(function(){showTooltip(a(this),lang[35],0,5,15)}),a(".arrowchat_chatroom_count").mouseleave(function(){hideTooltip()})}function receiveChatroom(){if(1!=c_chatrooms)return!1;clearTimeout(Crref2);var t="",r="";for(var o in $chatrooms)r+=o+",";r=r.slice(0,-1),a.ajax({url:c_ac_path+"includes/json/receive/receive_chatroom.php",cache:!1,type:"post",data:{chatrooms:r},dataType:"json",success:function(r){if(r.room_data){var o=!0,e=0,s=0;a(".arrowchat_chatroom_create_flyout_display").length&&(e=a(".arrowchat_chatroom_create_flyout_display").parent().attr("data-user-id"),s=a(".arrowchat_chatroom_create_flyout_display").parents(".arrowchat_tabpopup").attr("data-room-id")),r.room_data&&a.each(r.room_data,function(r,e){if(0!=e.error&&(o=!1,void 0!==$chatrooms[e.id]&&a(".arrowchat_closebox_bottom",$chatrooms[e.id]).click(),loadChatroomList(),displayMessage(a("#arrowchat_chatroom_message_flyout"),e.error_msg,"error")),chatroom_admin[e.id]=0,chatroom_mod[e.id]=0,o){1==e.user_title.admin&&(chatroom_admin[e.id]=1),1==e.user_title.mod&&(chatroom_mod[e.id]=1);var s=0,n=0,h=0,l=0;a(".arrowchat_room_userlist",$chatrooms_popups[e.id]).html('<div class="arrowchat_chatroom_line_admins" class="arrowchat_group_container"><span class="arrowchat_group_text">'+lang[148]+'</span><div class="arrowchat_group_line_container"><span class="arrowchat_group_line"></span></div></div><div class="arrowchat_chatroom_list_admins"></div><div class="arrowchat_chatroom_line_mods" class="arrowchat_group_container"><span class="arrowchat_group_text">'+lang[149]+'</span><div class="arrowchat_group_line_container"><span class="arrowchat_group_line"></span></div></div><div class="arrowchat_chatroom_list_mods"></div><div class="arrowchat_chatroom_line_users" class="arrowchat_group_container"><span class="arrowchat_group_text">'+lang[147]+'</span><div class="arrowchat_group_line_container"><span class="arrowchat_group_line"></span></div></div><div class="arrowchat_chatroom_list_users"></div>'),a(".arrowchat_chatroom_user_popouts",$chatrooms_popups[e.id]).html(""),a.each(e.chat_users,function(r,o){if("invisible"!=o.status){t="",l++,(1==chatroom_admin[e.id]||1==chatroom_mod[e.id])&&(1==o.t||4==o.t)&&(t='<li class="arrowchat_menu_separator"></li><li class="arrowchat_menu_item"><a class="arrowchat_chatroom_make_mod arrowchat_menu_anchor"><i class="fa-light fa-user-crown"></i><span>'+lang[52]+'</span></a></li><li class="arrowchat_menu_item"><a class="arrowchat_chatroom_silence_user arrowchat_menu_anchor"><i class="fa-light fa-volume-xmark"></i><span>'+lang[161]+'</span></a></li><li class="arrowchat_menu_item"><a class="arrowchat_chatroom_ban_user arrowchat_menu_anchor"><i class="fa-light fa-ban"></i><span>'+lang[53]+"</span></a></li>"),1==chatroom_admin[e.id]&&2==o.t&&(t='<li class="arrowchat_menu_separator"></li><li class="arrowchat_menu_item"><a class="arrowchat_chatroom_remove_mod arrowchat_menu_anchor"><i class="fa-light fa-circle-minus"></i><span>'+lang[54]+"</span></a></li>");var d=a(".arrowchat_chatroom_list_users",$chatrooms_popups[e.id]);2==o.t?(d=a(".arrowchat_chatroom_list_mods",$chatrooms_popups[e.id]),n++):3==o.t?(d=a(".arrowchat_chatroom_list_admins",$chatrooms_popups[e.id]),s++):h++,o.n=renderHTMLString(o.n);var w=" fas fa-circle";"away"==o.status?w=" fas fa-moon":"busy"==o.status&&(w=" far fa-mobile-screen"),a("<div/>").attr("data-user-pop-id",o.id).attr("class","arrowchat_chatroom_user").mouseover(function(){a(this).addClass("arrowchat_chatroom_list_hover")}).mouseout(function(){a(this).removeClass("arrowchat_chatroom_list_hover")}).addClass("arrowchat_chatroom_room_list").addClass("arrowchat_chatroom_admin_"+o.t).html('<img class="arrowchat_chatroom_avatar" src="'+o.a+'"/><span class="arrowchat_chatroom_room_name">'+o.n+'</span><span class="arrowchat_userscontentdot arrowchat_'+o.status+w+'"></span>').appendTo(d);var m="";(1==o.b&&1!=chatroom_admin[e.id]||o.id==u_id)&&(m=" arrowchat_no_private_msg"),a("<div/>").attr("data-user-id",o.id).addClass("arrowchat_more_wrapper_chatroom").html('<div class="arrowchat_more_popout"><div class="arrowchat_chatroom_flyout_avatar"><img src="'+o.a+'" alt="" /></div><ul class="arrowchat_inner_menu arrowchat_chatroom_flyout_info"><li class="arrowchat_menu_item"><a class="arrowchat_chatroom_title arrowchat_menu_anchor"><span class="arrowchat_chatroom_fullname">'+o.n+'</span></a></li><li class="arrowchat_menu_item"><a class="arrowchat_menu_anchor arrowchat_chatroom_private_message'+m+'"><i class="fa-light fa-messages"></i><span>'+lang[41]+'</span></a></li><li class="arrowchat_menu_item"><a class="arrowchat_menu_anchor arrowchat_chatroom_block_user"><i class="fa-light fa-user-slash"></i><span>'+lang[84]+'</span></a></li><li class="arrowchat_menu_item"><a class="arrowchat_menu_anchor arrowchat_chatroom_report_user"><i class="fa-light fa-triangle-exclamation"></i><span>'+lang[167]+"</span></a></li>"+t+"</ul></div>").appendTo(a(".arrowchat_chatroom_user_popouts",$chatrooms_popups[e.id])),addHover(a(".arrowchat_menu_item"),"arrowchat_more_hover")}uc_avatar[o.id]=o.a,uc_cr_block[o.id]=o.b}),chatroomUserOptions(chatroom_admin[e.id]);var d=function(t,r){return t.querySelector(".arrowchat_chatroom_room_name").innerHTML.toLowerCase().localeCompare(r.querySelector(".arrowchat_chatroom_room_name").innerHTML.toLowerCase())},w=a(".arrowchat_chatroom_list_users > div").get();w.sort(d);for(var r=0;r<w.length;r++)w[r].parentNode.appendChild(w[r]);0==h&&a(".arrowchat_chatroom_line_users",$chatrooms_popups[e.id]).hide(),0==s&&a(".arrowchat_chatroom_line_admins",$chatrooms_popups[e.id]).hide(),0==n&&a(".arrowchat_chatroom_line_mods",$chatrooms_popups[e.id]).hide(),modDeleteControls(e.id),1==chatroom_admin[e.id]||1==chatroom_mod[e.id]?addChatroomAdminControls(e.id):a(".arrowchat_admin_controls",$chatrooms_popups[e.id]).hide(),a(".arrowchat_chatroom_count_window span",$chatrooms_popups[e.id]).html(l),a(".arrowchat_chatroom_count_window span",$chatrooms[e.id]).html(l),a("#arrowchat_chatroom_"+e.id).find(".arrowchat_chatroom_count").children("span").html(l)}}),o&&(a(".arrowchat_chatroom_admin_3").css("background-color","#"+c_admin_bg),a(".arrowchat_chatroom_admin_3").css("color","#"+c_admin_txt),0!=e&&a('div[data-user-pop-id="'+e+'"]',$chatrooms_popups[s]).click(),preventScrolling(a(".arrowchat_room_userlist")),(1==c_disable_avatars||a("#arrowchat_setting_names_only :input").is(":checked"))&&setAvatarVisibility(1),a("#arrowchat_chatroom_show_names :input").is(":checked")&&setAvatarVisibility(0))}}}),clearTimeout(Crref2),Crref2=setTimeout(function(){receiveChatroom()},6e4)}function chatroomUserOptions(t){a(".arrowchat_chatroom_make_mod").unbind("click"),a(".arrowchat_chatroom_make_mod").click(function(){var t=a(this).parents(".arrowchat_more_wrapper_chatroom").attr("data-user-id"),r=a(this).parents(".arrowchat_tabpopup").attr("data-room-id");a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_mod:t,chatroom_id:r},function(){receiveChatroom()}),toggleChatroomUserInfo(a(this),t)}),a(".arrowchat_chatroom_remove_mod").unbind("click"),a(".arrowchat_chatroom_remove_mod").click(function(){var t=a(this).parents(".arrowchat_more_wrapper_chatroom").attr("data-user-id"),r=a(this).parents(".arrowchat_tabpopup").attr("data-room-id");a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_remove_mod:t,chatroom_id:r},function(){receiveChatroom()}),toggleChatroomUserInfo(a(this),t)}),a(".arrowchat_chatroom_block_user").unbind("click"),a(".arrowchat_chatroom_block_user").click(function(){var t=a(this).parents(".arrowchat_more_wrapper_chatroom").attr("data-user-id"),r=a(this).parents(".arrowchat_tabpopup").attr("data-room-id");a.post(c_ac_path+"includes/json/send/send_settings.php",{block_chat:t},function(o){"-1"!=o&&(void 0===blockList[t]&&(blockList[t]=t),loadBuddyList(),displayMessage(a(".arrowchat_message_box",$chatrooms_popups[r]),lang[103],"notice"))}),toggleChatroomUserInfo(a(this),t)}),1!=c_enable_moderation&&a(".arrowchat_chatroom_report_user").parent().hide(),a(".arrowchat_chatroom_report_user").unbind("click"),a(".arrowchat_chatroom_report_user").click(function(){var t=a(this).parents(".arrowchat_more_wrapper_chatroom").attr("data-user-id"),r=a(this).parents(".arrowchat_tabpopup").attr("data-room-id");a.post(c_ac_path+"includes/json/send/send_settings.php",{report_about:t,report_from:u_id,report_chatroom:r},function(t){displayMessage(a(".arrowchat_message_box",$chatrooms_popups[r]),lang[168],"notice")}),toggleChatroomUserInfo(a(this),t)}),a(".arrowchat_chatroom_ban_user").unbind("click"),a(".arrowchat_chatroom_ban_user").click(function(){var t=a(this).parents(".arrowchat_more_wrapper_chatroom").attr("data-user-id"),r=a(this).parents(".arrowchat_tabpopup").attr("data-room-id"),o=prompt(lang[57]);null==o||""==o||isNaN(o)||a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_ban:t,chatroom_id:r,chatroom_ban_length:o},function(){receiveChatroom()}),toggleChatroomUserInfo(a(this),t)}),a(".arrowchat_chatroom_silence_user").unbind("click"),a(".arrowchat_chatroom_silence_user").click(function(){var t=a(this).parents(".arrowchat_more_wrapper_chatroom").attr("data-user-id"),r=a(this).parents(".arrowchat_tabpopup").attr("data-room-id"),o=prompt(lang[162]);null==o||""==o||isNaN(o)||a.post(c_ac_path+"includes/json/send/send_settings.php",{chatroom_silence:t,chatroom_id:r,chatroom_silence_length:o},function(){}),toggleChatroomUserInfo(a(this),t)}),a(".arrowchat_chatroom_private_message").unbind("click"),a(".arrowchat_chatroom_private_message").click(function(){var t=a(this).parents(".arrowchat_more_wrapper_chatroom").attr("data-user-id");a(this).parents(".arrowchat_tabpopup").attr("data-room-id"),u_id!=t&&(1!=uc_cr_block[t]||1==chatroom_admin[t]||1==chatroom_mod[t])&&(toggleChatroomUserInfo(a(this),t),jqac.arrowchat.chatWith(t))}),a(".arrowchat_chatroom_title").unbind("click"),a(".arrowchat_chatroom_title").click(function(){var t=a(this).parents(".arrowchat_more_wrapper_chatroom").attr("data-user-id");void 0!==uc_link[t]&&window.open(uc_link[t],"_self")}),a(".arrowchat_chatroom_user").unbind("click"),a(".arrowchat_chatroom_user").click(function(){var t=a(this).parents(".arrowchat_tabpopup").attr("data-room-id"),r=a(this).attr("data-user-pop-id");a(".arrowchat_chatroom_user").removeClass("arrowchat_chatroom_clicked"),a(".arrowchat_more_popout").removeClass("arrowchat_chatroom_create_flyout_display"),a(this).toggleClass("arrowchat_chatroom_clicked"),a('div[data-user-id="'+r+'"]',$chatrooms_popups[t]).children(".arrowchat_more_popout").toggleClass("arrowchat_chatroom_create_flyout_display")}),a("body").click(function(t){!a(t.target).closest(".arrowchat_chatroom_user").length&&(a(t.target).closest(".arrowchat_more_popout").length||(a(".arrowchat_chatroom_user").removeClass("arrowchat_chatroom_clicked"),a(".arrowchat_more_popout").removeClass("arrowchat_chatroom_create_flyout_display")))})}function toggleChatroomUserInfo(t,r){var o=t.parents(".arrowchat_tabpopup").attr("data-room-id");a('div[data-user-pop-id="'+r+'"]',$chatrooms_popups[o]).toggleClass("arrowchat_chatroom_clicked"),a('div[data-user-id="'+r+'"]',$chatrooms_popups[o]).children(".arrowchat_more_popout").toggleClass("arrowchat_chatroom_create_flyout_display")}function loadBuddyList(){if(clearTimeout(Z),a.ajax({url:c_ac_path+"includes/json/receive/receive_buddylist.php",cache:!1,type:"get",dataType:"json",success:function(t){buildBuddyList(t),1==c_disable_avatars&&a(".arrowchat_userlist_avatar").addClass("arrowchat_hide_avatars")}}),"undefined"!=typeof c_list_heart_beat)var t=1e3*c_list_heart_beat;else var t=6e4;Z=setTimeout(function(){loadBuddyList()},t)}function buildBuddyList(t){var r={},o="";r.available="",r.busy="",r.offline="",r.invisible="",r.away="",onlineNumber=buddylistreceived=0,t&&a.each(t,function(t,e){if("buddylist"==t&&(buddylistreceived=1,totalFriendsNumber=onlineNumber=0,a.each(e,function(t,e){longname=renderHTMLString(e.n),null!=G[e.id]&&(a(".arrowchat_closed_status",$users[e.id]).removeClass("arrowchat_available").removeClass("arrowchat_busy").removeClass("arrowchat_offline").removeClass("arrowchat_away").addClass("arrowchat_"+e.s),a(".arrowchat_chat_window_status",$user_popups[e.id]).removeClass("arrowchat_available").removeClass("arrowchat_busy").removeClass("arrowchat_offline").removeClass("arrowchat_away").addClass("arrowchat_"+e.s),$users[e.id].removeClass("arrowchat_tab_offline").removeClass("arrowchat_away").addClass("arrowchat_tab_"+e.s),void 0!==$user_popups[e.id]&&a(".arrowchat_tabsubtitle .arrowchat_message",$user_popups[e.id]).html(e.m),"offline"==e.s||"busy"==e.s&&2!=c_video_select&&3!=c_video_select?a(".arrowchat_tabtitle .arrowchat_video_icon",$user_popups[e.id]).addClass("arrowchat_video_unavailable"):a(".arrowchat_tabtitle .arrowchat_video_icon",$user_popups[e.id]).removeClass("arrowchat_video_unavailable")),("available"==e.s||"away"==e.s||"busy"==e.s)&&onlineNumber++,totalFriendsNumber++,a("#arrowchat_setting_names_only :input").is(":checked")&&(o="arrowchat_hide_avatars");var s=" fas fa-circle";"away"==e.s?s=" fas fa-moon":"busy"==e.s&&(s=" far fa-mobile-screen"),r[e.s]+='<div id="arrowchat_userlist_'+e.id+'" class="arrowchat_userlist arrowchat_buddylist_admin_'+e.admin+'" onmouseover="jqac(this).addClass(\'arrowchat_userlist_hover\');" onmouseout="jqac(this).removeClass(\'arrowchat_userlist_hover\');"><img class="arrowchat_userlist_avatar '+o+'" src="'+e.a+'" /><span class="arrowchat_userscontentname">'+longname+'</span><span class="arrowchat_userscontentdot arrowchat_'+e.s+s+'"></span></div>',uc_status[e.id]=e.s,uc_name[e.id]=e.n,uc_avatar[e.id]=e.a,uc_link[e.id]=e.l})),1==buddylistreceived&&0==bli){for(buddystatus in r)r.hasOwnProperty(buddystatus)&&(""==r[buddystatus]?a("#arrowchat_userslist_"+buddystatus).html(""):a("#arrowchat_userslist_"+buddystatus).html("<div>"+r[buddystatus]+"</div>"));a(".arrowchat_userlist").click(function(t){a(this).hasClass("arrowchat_jabber_user")||receiveUserFromUserlist(t.target)}),a("#arrowchat_mobiletab_count").html(onlineNumber),R=onlineNumber,0==totalFriendsNumber&&a("#arrowchat_userslist_available").html('<div class="arrowchat_nofriends">'+lang[8]+"</div>"),0==R&&a("#arrowchat_userslist_available").html('<div class="arrowchat_nofriends">'+lang[8]+"</div>"),buddylistreceived=0}else a("#arrowchat_mobiletab_count").html(onlineNumber);a(".arrowchat_buddylist_admin_1").css("background-color","#"+c_admin_bg),a(".arrowchat_buddylist_admin_1").css("color","#"+c_admin_txt)})}function cancelJSONP(){"undefined"!=typeof CHA&&clearTimeout(CHA),"undefined"!=typeof xOptions&&xOptions.abort()}function receiveCore(){cancelJSONP();var t="";if(!a.isEmptyObject(chatroom_list))for(var r in chatroom_list)t=t+"&room[]="+chatroom_list[r];var o=c_ac_path+"includes/json/receive/receive_core.php?hash="+u_hash_id+"&init="+acsi+t;if(xOptions=a.ajax({url:o,dataType:"jsonp",success:function(t){var r="",o={};if(o.available="",o.busy="",o.offline="",o.away="",onlineNumber=buddylistreceived=0,t&&null!=t){var e=0;a.each(t,function(t,s){if("typing"==t&&a.each(s,function(t,r){"1"==r.is_typing?(lsClick(r.typing_id,"typing"),receiveTyping(r.typing_id)):(lsClick(r.typing_id,"untyping"),receiveNotTyping(r.typing_id))}),"announcements"==t&&a.each(s,function(t,r){receiveAnnouncement(r)}),"warnings"==t&&a.each(s,function(t,r){receiveWarning(r)}),"chatroom"==t){var n=[],h=[],l=0;if(a.each(s,function(t,r){1==r.action?a("#arrowchat_chatroom_message_"+r.m+" .arrowchat_chatroom_msg").html(lang[159]+r.n):(void 0===blockList[r.userid]&&(addChatroomMessage(r.id,r.n,r.m,r.userid,r.t,r.global,r.mod,r.admin,r.chatroomid),lsClick(JSON.stringify([r.id,r.n,r.m,r.userid,r.t,r.global,r.mod,r.admin,r.chatroomid]),"chatroom_message")),a(".arrowchat_chatroom_message_input").is(":focus")||r.userid==u_id||(l=1),h[r.chatroomid]=r,void 0!==n[r.chatroomid]?n[r.chatroomid]=n[r.chatroomid]+1:n[r.chatroomid]=1)}),h.length>0){for(var d in showChatroomTime(),h)void 0===blockList[h[d].userid]&&(chatroomAlerts(n[d],h[d].chatroomid),lsClick(JSON.stringify([n[d],h[d].chatroomid]),"chatroom_alerts"));1==u_chatroom_sound&&1==l&&playNewMessageSound()}}if("notifications"==t){var m="";a.each(s,function(t,r){addNotification(r.alert_id,r.markup),m=r.markup}),notificationAlerts(m)}if("messages"==t){var u=0;a.each(s,function(t,r){receiveMessage(r.id,r.from,r.message,r.sent,r.self,r.old,0,0),a(".arrowchat_textarea",$user_popups[r.from]).is(":focus")||(u=1)}),K=1,D=E,""!=j&&e>0&&addMessageToContent(j,r),showTimeAndTooltip(),1!=o&&1==u_sounds&&1==u&&1!=acsi&&playNewMessageSound()}})}set("initialize","0"),set("currenttime","0"),1!=$&&1!=w&&(++K>4&&(D*=2,K=1),D>12e3&&(D=12e3)),acsi++}}),1==isAway)var e=3e3*c_heart_beat;else var e=1e3*c_heart_beat;1!=c_push_engine&&(CHA=setTimeout(function(){receiveCore()},e))}function addChatroomMessage(t,r,o,e,s,n,h,l,d){e==u_id&&(uc_avatar[u_id]=u_avatar),o=replaceURLWithHTMLLinks(o=stripslashes(o));var w=new Date(1e3*s);void 0===uc_avatar[e]?a.ajax({url:c_ac_path+"includes/json/receive/receive_user.php",data:{userid:e},type:"post",cache:!1,dataType:"json",success:function(s){s&&(uc_avatar[e]=s.a,chatroomDiv(t,uc_avatar[e],r,w,o,n,h,l,e,d))}}):chatroomDiv(t,uc_avatar[e],r,w,o,n,h,l,e,d),count++}function chatroomDiv(t,r,o,e,s,n,h,l,d,w){if(d==u_id&&0==n)return!1;var m=a(".arrowchat_tabcontenttext",$chatrooms_popups[w])[0].scrollHeight-a(".arrowchat_tabcontenttext",$chatrooms_popups[w]).scrollTop()-10,u=a(".arrowchat_tabcontenttext",$chatrooms_popups[w]).outerHeight(),p="",v="",g="",b="";d==u_id&&(v="arrowchat_self"),1==h&&(p=lang[137],g="arrowchat_chatroom_important"),1==l&&(p=lang[137],g="arrowchat_chatroom_important"),"<div"==s.substr(0,4)&&(b=" arrowchat_image_msg"),a(".arrowchat_pending_icon:not(.arrowchat_pending_error)",$chatrooms_popups[w]).hide(),a(".arrowchat_tabcontenttext .arrowchat_chatroom_box_message .arrowchat_pending_icon:last",$chatrooms_popups[w]).show();var _=RegExp("(^|\\s)(@"+u_name+")(\\s|$)","i");if(s=s.replace(_,'$1<span class="arrowchat_at_user">$2</span>$3'),a("#arrowchat_chatroom_message_"+t).length>0)a("#arrowchat_chatroom_message_"+t+" .arrowchat_chatroom_msg").html(s),d==u_id&&a("#arrowchat_chatroom_message_"+t).addClass(v);else{var $=formatTimestamp(e,1);if(1==n)a("<div/>").attr("id","arrowchat_chatroom_message_"+t).addClass("arrowchat_chatroom_box_message").addClass("arrowchat_global_chatroom_message").html('<div class="arrowchat_chatroom_message_content">'+formatTimestamp(e)+s+"</div>").appendTo(a(".arrowchat_tabcontenttext",$chatrooms_popups[w])),receiveChatroom();else{var y=getRandomColor(o);a("<div/>").attr("id","arrowchat_chatroom_message_"+t).addClass(g).addClass(b).addClass(v).addClass("arrowchat_chatroom_box_message").html('<div class="arrowchat_chatroom_message_name"><i class="'+p+'"></i>'+o+'</div><div class="arrowchat_chatroom_msg_wrap"><div class="arrowchat_chatbox_avatar_wrapper arrowchat_white_background" style="background-color:'+y.color+'"><img class="arrowchat_chatroom_message_avatar arrowchat_no_names" src="'+r+'" alt="'+o+'" /><span class="arrowchat_tab_letter arrowchat_tab_letter_xsmall">'+y.character+'</span></div><div class="arrowchat_chatroom_message_content" data-id="'+$+'"><span class="arrowchat_chatroom_msg">'+s+'</span></div><div class="arrowchat_message_controls"><div class="arrowchat_chatroom_reply"><i class="fas fa-reply"></i></div><div class="arrowchat_chatroom_delete" data-id="'+t+'"><i class="far fa-xmark"></i></div></div></div>').appendTo(a(".arrowchat_tabcontenttext",$chatrooms_popups[w]))}(1==c_disable_avatars||a("#arrowchat_setting_names_only :input").is(":checked"))&&setAvatarVisibility(1),m<=u?(a(".arrowchat_tabcontenttext",$chatrooms_popups[w]).scrollTop(5e4),a(".arrowchat_image_msg img,.arrowchat_emoji_text img").one("load",function(){setTimeout(function(){a(".arrowchat_tabcontenttext",$chatrooms_popups[w]).scrollTop(5e4)},500)}).each(function(){this.complete&&a(this).trigger("load")})):displayMessage(a(".arrowchat_message_box",$chatrooms_popups[w]),lang[134],"notice"),showChatroomTime(),modDeleteControls(w)}}function chatroomAlerts(t,r){if(void 0!==$chatrooms[r]){if($chatrooms[r].hasClass("arrowchat_tabclick"))return!1;a(".arrowchat_tabalert",$chatrooms[r]).length>0&&(t=parseInt(a(".arrowchat_tabalert",$chatrooms[r]).html())+parseInt(t)),0==t?($chatrooms[r].removeClass("arrowchat_tab_new_message"),a(".arrowchat_tabalert",$chatrooms[r]).remove()):(a(".arrowchat_tabalert",$chatrooms[r]).length>0?a(".arrowchat_tabalert",$chatrooms[r]).html(t):a("<div/>").addClass("arrowchat_tabalert").html(t).appendTo($chatrooms[r]),$chatrooms[r].removeClass("arrowchat_tab_new_message").addClass("arrowchat_tab_new_message")),adjustSizes()}}function receiveAnnouncement(t){if(0==t.read&&""!=t.data){if(a("#arrowchat_announcement").remove(),$body.append(ArrowChat.Templates.announcements_display(t)),a("#arrowchat_warnings").length){var r=parseInt(a(window).height()-a("#arrowchat_warnings").position().top);a("#arrowchat_announcement").css("bottom",r+5+"px")}a("#arrowchat_announcement .arrowchat_announce_close").click(function(){if(a("#arrowchat_announcement").remove(),a("#arrowchat_warnings").length)var t=parseInt(a("#arrowchat_mobiletab").outerHeight()+parseInt(a("#arrowchat_mobiletab").css("bottom"))+3);a("#arrowchat_warnings").css("bottom",t+"px"),a.post(c_ac_path+"includes/json/send/send_settings.php",{announce:1},function(){})})}else a("#arrowchat_announcement").remove()}function addNotification(t,r){a("<div/>").attr("id","arrowchat_alert_"+t).attr("class","arrowchat_notification_message_div").html(r).appendTo(a("#arrowchat_notifications_content")),a(".arrowchat_notifications_divider").removeClass("arrowchat_notifications_divider_last"),a("#arrowchat_notifications_content div:last-child .arrowchat_notifications_divider").addClass("arrowchat_notifications_divider_last"),Q++}function notificationAlerts(t){if(a("#arrowchat_bell_flyout").hasClass("arrowchat_bell_flyout_display"));else{var r=parseInt(a(".arrowchat_mobiletab_new_count").html())+Q;a(".arrowchat_mobiletab_new_count").html(r),a("#arrowchat_mobiletab_new").show(),a("#arrowchat_bell_notification").show().html(Q)}Q>0&&a("#arrowchat_no_new_notifications").css("display","none")}function stripslashes(a){return a=(a=(a=(a=a.replace(/\\'/g,"'")).replace(/\\"/g,'"')).replace(/\\0/g,"\0")).replace(/\\\\/g,"\\")}function notifyNewMessage(t,r){if(null==uc_name[t]||""==uc_name[t])setTimeout(function(){notifyNewMessage(t,r)},500);else if(void 0!==$users[t]){if($users[t].hasClass("arrowchat_tabclick"))return!1;a(".arrowchat_tabalert",$users[t]).length>0&&(r=parseInt(a(".arrowchat_tabalert",$users[t]).html())+parseInt(r)),0==r?($users[t].removeClass("arrowchat_tab_new_message"),a(".arrowchat_tabalert",$users[t]).remove()):(a(".arrowchat_tabalert",$users[t]).length>0?a(".arrowchat_tabalert",$users[t]).html(r):a("<div/>").addClass("arrowchat_tabalert").html(r).appendTo($users[t]),$users[t].removeClass("arrowchat_tab_new_message").addClass("arrowchat_tab_new_message")),y[t]=r}adjustSizes()}function receiveMessage(t,r,o,e,s,n,h,l){if(0==l&&1==s&&0==h)return!1;if(1!=aa[r]&&receiveUser(r,uc_name[r],uc_status[r],uc_avatar[r],uc_link[r],1,1),0==l&&1!=s&&1!=c_push_engine){var d=[t,r,o,e,s,n];acsi>2&&lsClick(JSON.stringify(d),"private_message")}if(clearTimeout(dtit3),document.title=dtit,null==uc_name[r]||""==uc_name[r])setTimeout(function(){receiveMessage(t,r,o,e,s,n,h,l)},500);else{lsClick(r,"untyping"),receiveNotTyping(r);var w=a(".arrowchat_tabcontenttext",$user_popups[r])[0].scrollHeight-a(".arrowchat_tabcontenttext",$user_popups[r]).scrollTop()-10,m=a(".arrowchat_tabcontenttext",$user_popups[r]).outerHeight(),u=uc_name[r];if("offline"==uc_status[r]&&1!=s&&Math.floor(Date.now()/1e3)-e<10&&loadBuddyList(),f="",1==s){fromname=u_name,fromid=u_id,f=" arrowchat_self",avatar=u_avatar;var p="<div class='arrowchat_pending_icon'></div>";1==h&&(p="<div class='arrowchat_pending_icon arrowchat_pending_delivered'></div>")}else{DTitChange(uc_name[r]),fromname=u,fromid=r,avatar=uc_avatar[r];var p="";a(".arrowchat_pending_icon:not(.arrowchat_pending_error)",$user_popups[r]).hide(),a(".arrowchat_tabcontenttext div .arrowchat_pending_icon:last",$user_popups[r]).show()}var v="",g="";0!=l&&(v=" arrowchat_pending_msg",g=" arrowchat_pending_msg_"+l),tooltip=formatTimestamp(new Date(1e3*e),1);var b="",_="";if(o=stripslashes(o),1==h&&(o=youTubeEmbed(o)),o=replaceURLWithHTMLLinks(o),1==h&&(o=smileyreplace(o)),"<div"==o.substr(0,4)&&(b=" arrowchat_image_msg"),(null==last_sent[r]||e-last_sent[r]>180)&&(_=" arrowchat_show_time"),a("#arrowchat_message_"+t).length>0&&0==l)a("#arrowchat_message_"+t+" .arrowchat_chatboxmessagecontent").html(o);else{if(1!=c_show_full_name&&-1!=fromname.indexOf(" ")&&(fromname=fromname.slice(0,fromname.indexOf(" "))),0!=t)var $=' id="arrowchat_message_'+t+'" ';else var $="";var y=getRandomColor(fromname);a(".arrowchat_tabcontenttext",$user_popups[r]).append('<div class="arrowchat_chatboxmessage arrowchat_clearfix'+f+b+_+v+g+'" '+$+">"+formatTimestamp(new Date(1e3*e))+'<div class="arrowchat_chatboxmessagefrom arrowchat_white_background" style="background-color:'+y.color+'"><span class="arrowchat_tab_letter arrowchat_tab_letter_xsmall">'+y.character+'</span><img alt="'+fromname+'" class="arrowchat_chatbox_avatar" src="'+avatar+'" /></div><div class="arrowchat_chatboxmessage_wrapper"><div class="arrowchat_chatboxmessagecontent" data-id="'+tooltip+'">'+o+"</div></div>"+p+"</div>"),a("#arrowchat_message_"+last_id[r]).length&&1!=s&&a("#arrowchat_message_"+last_id[r]).children(".arrowchat_chatboxmessagefrom").addClass("arrowchat_single_avatar_hide"),last_sent[r]=e,last_name[r]=fromid,0==l&&(last_id[r]=t),(1==c_disable_avatars||a("#arrowchat_setting_names_only :input").is(":checked"))&&setAvatarVisibility(1),showTimeAndTooltip()}w<=m||!$users[r].hasClass("arrowchat_tabclick")?(a(".arrowchat_tabcontenttext",$user_popups[r]).scrollTop(5e4),a(".arrowchat_image_msg img,.arrowchat_emoji_text img").one("load",function(){setTimeout(function(){a(".arrowchat_tabcontenttext",$user_popups[r]).scrollTop(5e4)},500)}).each(function(){this.complete&&a(this).trigger("load")})):displayMessage(a(".arrowchat_message_box",$user_popups[r]),lang[134],"notice"),notifyNewMessage(r,1)}}function receiveTyping(t){if(void 0!==$users[t]){var r=a(".arrowchat_tabcontenttext",$user_popups[t])[0].scrollHeight-a(".arrowchat_tabcontenttext",$user_popups[t]).scrollTop()-10,o=a(".arrowchat_tabcontenttext",$user_popups[t]).outerHeight();a(".arrowchat_is_typing",$users[t]).show(),a("#arrowchat_typing_message_"+t,$user_popups[t]).length&&a("#arrowchat_typing_message_"+t,$user_popups[t]).remove();var e=getRandomColor(uc_name[t]);a(".arrowchat_tabcontenttext",$user_popups[t]).append('<div class="arrowchat_chatboxmessage arrowchat_clearfix" id="arrowchat_typing_message_'+t+'"><div class="arrowchat_chatboxmessagefrom arrowchat_white_background" style="background-color:'+e.color+'"><span class="arrowchat_tab_letter arrowchat_tab_letter_xsmall">'+e.character+'</span><img alt="" class="arrowchat_chatbox_avatar" src="'+uc_avatar[t]+'" /></div><div class="arrowchat_chatboxmessage_wrapper"><div class="arrowchat_chatboxmessagecontent" data-id="Typing"><div class="arrowchat_is_typing arrowchat_is_typing_chat"><div class="arrowchat_typing_bubble"></div><div class="arrowchat_typing_bubble"></div><div class="arrowchat_typing_bubble"></div></div></div></div></div>'),(1==c_disable_avatars||a("#arrowchat_setting_names_only :input").is(":checked"))&&setAvatarVisibility(1),(r<=o||!$users[t].hasClass("arrowchat_tabclick"))&&a(".arrowchat_tabcontenttext",$user_popups[t]).scrollTop(5e4),clearTimeout(typingTimeout),typingTimeout=setTimeout(function(){lsClick(t,"untyping"),receiveNotTyping(t)},3e4)}}function receiveNotTyping(t){void 0!==$users[t]&&(clearTimeout(typingTimeout),a("#arrowchat_typing_message_"+t,$user_popups[t]).length&&a("#arrowchat_typing_message_"+t,$user_popups[t]).remove(),a(".arrowchat_is_typing",$users[t]).hide())}function pushCancelAll(){1==c_push_engine&&(push_uid.unsubscribe(),push_arrowchat.unsubscribe(),Object.keys(chatroom_list).length>0&&a.each(chatroom_list,function(t,r){push_room[r].unsubscribe()}))}function pushSubscribe(){1==c_push_engine&&(push_uid=push.subscribe(c_push_encrypt+"_u"+u_id),(push_arrowchat=push.subscribe(c_push_encrypt+"_arrowchat")).on("data",function(a){pushReceive(a)}),push_uid.on("data",function(a){pushReceive(a)}))}function pushReceive(t){if("announcement"in t&&receiveAnnouncement(t.announcement),"warning"in t&&receiveWarning(t.warning),"notification"in t){var r;addNotification(t.notification.alert_id,t.notification.markup),notificationAlerts(r)}if("chatroommessage"in t&&void 0===blockList[t.chatroommessage.userid]){addChatroomMessage(t.chatroommessage.id,t.chatroommessage.name,t.chatroommessage.message,t.chatroommessage.userid,t.chatroommessage.sent,t.chatroommessage.global,t.chatroommessage.mod,t.chatroommessage.admin,t.chatroommessage.chatroomid);var o=[t.chatroommessage.id,t.chatroommessage.name,t.chatroommessage.message,t.chatroommessage.userid,t.chatroommessage.sent,t.chatroommessage.global,t.chatroommessage.mod,t.chatroommessage.admin,t.chatroommessage.chatroomid];if(lsClick(JSON.stringify(o),"chatroom_message"),"Delete"!=t.chatroommessage.name&&1!=t.chatroommessage.global){chatroomAlerts(1,t.chatroommessage.chatroomid);var o=[1,t.chatroommessage.chatroomid];lsClick(JSON.stringify(o),"chatroom_alerts"),t.chatroommessage.userid!=u_id&&(1!=u_chatroom_sound||a(".arrowchat_chatroom_message_input").is(":focus")||playNewMessageSound())}}"typing"in t&&(lsClick(t.typing.id,"typing"),receiveTyping(t.typing.id)),"nottyping"in t&&(lsClick(t.nottyping.id,"untyping"),receiveNotTyping(t.nottyping.id)),"messages"in t&&(receiveMessage(t.messages.id,t.messages.from,t.messages.message,t.messages.sent,t.messages.self,t.messages.old,0,0),1==t.messages.self||1!=u_sounds||a(".arrowchat_textarea",$user_popups[t.messages.from]).is(":focus")||playNewMessageSound(),showTimeAndTooltip(),K=1,D=E),"chatroomban"in t&&(a(".arrowchat_closebox_bottom",$chatroos[t.chatroomban.id]).click(),displayMessage(a("#arrowchat_chatroom_message_flyout"),t.chatroomban.error2,"error"))}function DTitChange(a){a=renderHTMLString(a),2!=dtit2?(document.title=lang[30]+" "+a+"!",dtit2=2):(document.title=dtit,dtit2=1),!1==window_focus?dtit3=setTimeout(function(){DTitChange(a)},1e3):(document.title=dtit,clearTimeout(dtit3),setTimeout(function(){lsClick("body","window_focus")},500))}function changePushChannel(a,t){1==t?(1==c_push_engine&&(push_room[a]=push.subscribe(c_push_encrypt+"_chatroom"+a),push_room[a].on("data",function(a){pushReceive(a)})),chatroom_list[a]=a):(1==c_push_engine&&void 0!==push_room[a]&&push_room[a].unsubscribe(),void 0!==chatroom_list[a]&&delete chatroom_list[a])}function lsClick(id,action,acvar){if(0==lsreceive){var milliseconds=new Date().getTime();"ac_openclose"==action?void 0===acvar?a(id).hasClass("arrowchat_tabclick")?localStorage.setItem("ac_close",id+"/"+milliseconds):localStorage.setItem("ac_open",id+"/"+milliseconds):(eval("var temp=$"+acvar+";")," "==id?temp.hasClass("arrowchat_tabclick")?localStorage.setItem("ac_close",id+","+acvar+"/"+milliseconds):localStorage.setItem("ac_open",id+","+acvar+"/"+milliseconds):a(id,acvar).hasClass("arrowchat_tabclick")?localStorage.setItem("ac_close",id+","+acvar+"/"+milliseconds):localStorage.setItem("ac_open",id+","+acvar+"/"+milliseconds)):"private_message"==action||"chatroom_message"==action||"chatroom_alerts"==action||"send_chatroom_message"==action?msieversion()||localStorage.setItem(action,id+"/##-"+milliseconds):msieversion()||(void 0===acvar?localStorage.setItem(action,id+"/"+milliseconds):localStorage.setItem(action,id+","+acvar+"/"+milliseconds))}}function msieversion(){return!!(window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./))}function localStorageFired(e){if(lsreceive=1,"ac_open"==e.key||"ac_close"==e.key||"ac_click"==e.key){var res=e.newValue.split("/"),res2=res[0].split(",");void 0===res2[1]?"ac_click"==e.key?a(res2[0]).click():a(res2[0]).hasClass("arrowchat_tabclick")||"ac_open"!=e.key?a(res2[0]).hasClass("arrowchat_tabclick")&&"ac_close"==e.key&&a(res2[0]).click():a(res2[0]).click():(eval("var temp=$"+res2[1]+";")," "==res2[0]?"undefined"!=typeof temp&&"ac_click"==e.key?temp.click():"undefined"==typeof temp||temp.hasClass("arrowchat_tabclick")||"ac_open"!=e.key?"undefined"!=typeof temp&&temp.hasClass("arrowchat_tabclick")&&"ac_close"==e.key&&temp.click():temp.click():a(res2[0],temp).length&&"ac_click"==e.key?a(res2[0],temp).click():a(res2[0],temp).length&&!a(res2[0],temp).hasClass("arrowchat_tabclick")&&"ac_open"==e.key?a(res2[0],temp).click():a(res2[0],temp).length&&a(res2[0],temp).hasClass("arrowchat_tabclick")&&"ac_close"==e.key&&a(res2[0],temp).click())}if("window_focus"==e.key&&(clearTimeout(dtit3),document.title=dtit),"private_message"==e.key){var res=e.newValue.split("/##-"),data=JSON.parse(res[0]);receiveMessage(data[0],data[1],data[2],data[3],data[4],1,1,0)}if("open_chatroom"==e.key){var res=e.newValue.split("/");loadChatroom(res[0],"")}if("send_chatroom_message"==e.key){var res=e.newValue.split("/##-"),data=JSON.parse(res[0]),tester=data[3];"cr-"==tester.substring(0,3)&&(tester=tester.substr(3)),addMessageToChatroom(data[0],data[1],data[2],1,tester,0),a(".arrowchat_tabcontenttext",$chatrooms_popups[tester]).scrollTop(a(".arrowchat_tabcontenttext",$chatrooms_popups[tester])[0].scrollHeight),a(".arrowchat_image_msg img,.arrowchat_emoji_text img").one("load",function(){a(".arrowchat_tabcontenttext",$chatrooms_popups[tester]).scrollTop(5e4)}).each(function(){this.complete&&a(this).trigger("load")})}if(1!=c_push_engine){if("untyping"==e.key){var res=e.newValue.split("/");receiveNotTyping(res[0])}if("typing"==e.key){var res=e.newValue.split("/");receiveTyping(res[0])}if("chatroom_message"==e.key){var res=e.newValue.split("/##-"),data=JSON.parse(res[0]),tester=data[8];"cr-"==tester.substring(0,3)&&(tester=tester.substr(3)),addChatroomMessage(data[0],data[1],data[2],data[3],data[4],data[5],data[6],data[7],tester)}if("chatroom_alerts"==e.key){var res=e.newValue.split("/##-"),data=JSON.parse(res[0]),tester=data[1];"cr-"==tester.substring(0,3)&&(tester=tester.substr(3)),chatroomAlerts(data[0],tester)}}lsreceive=0}function runarrowchat(){if(a.ajax({url:c_ac_path+"includes/json/receive/receive_init.php",cache:!1,type:"get",dataType:"json",success:function(t){}}),Modernizr.emoji2||(c_disable_smilies=1),$base=a("<div/>").attr("id","arrowchat_base").appendTo($body),window.addEventListener("storage",localStorageFired,!1),1==c_push_engine&&(push=new Scaledrone(c_push_publish)),0!=c_chat_maintenance||1==c_db_connection||0!=c_guests_login_msg&&""==u_id?buildMaintenance():(buildBuddyListTab(),0!=c_chatrooms?buildChatroomsButton():a("#arrowchat_room_selection").hide(),buildOptionsButton(),1==u_is_mod&&1==c_enable_moderation&&buildModButton(),buildUnseenUsers()),a(".arrowchat_powered_by").each(function(){this.style.setProperty("display","block","important")}),-1==acp.search(/arrowchat/i)||!a(".arrowchat_powered_by")[0]&&!a("#arrowchat_maintenance")[0]||""==a(".arrowchat_powered_by").html()||a(".arrowchat_powered_by").not(':contains("ArrowChat")').html())return console.log("bfd"),a("#arrowchat_base").hide(),!1;if(0==c_online_list&&(a("#arrowchat_buddy_list_tab").hide(),a("#arrowchat_closed_windows").addClass("arrowchat_online_list_hidden")),$body.append('<div id="arrowchat_sound_player_holder"></div>'),a(window).bind("resize",adjustSizes),a(window).on("resize",function(){clearTimeout(windowresize_timeout),windowresize_timeout=setTimeout(function(){adjustSizes()},500)}),set("buddylist","1"),set("initialize","1"),set("currenttime",ab),a(window).focus(function(){window_focus=!0,lsClick("body","window_focus")}).blur(function(){window_focus=!1}),void 0===document.body.style.maxHeight&&(W=!0,$base.css("position","absolute"),$tooltip.css("position","absolute"),$userstab_popup.css("position","absolute")),"offline"==u_status)w=1,clearUserStatus(),a("#arrowchat_mobiletab").addClass("arrowchat_mobiletab_offline"),$buddy_list_tab.removeClass("arrowchat_tabclick").removeClass("arrowchat_userstabclick"),$userstab_popup.removeClass("arrowchat_tabopen"),$open_windows.hide(),$closed_windows.hide(),a.idleTimer("destroy");else if(1!=c_chat_maintenance&&1!=c_db_connection&&""!=u_id){1==c_push_engine&&pushSubscribe();for(var t=!1,r=0;r<focus_chat.length;r++)focus_chat[r],"1"==focus_is_room[r]?0!=c_chatrooms&&(init_open_room[focus_chat[r]]=0,changePushChannel(focus_chat[r],1),toggleUserChatTab(focus_chat[r],"0",!0,""),t=!0):(init_open[focus_chat[r]]=0,receiveUser(focus_chat[r],uc_name[focus_chat[r]],uc_status[focus_chat[r]],uc_avatar[focus_chat[r]],uc_link[focus_chat[r]],"0"));for(var r=0;r<unfocus_chat.length;r++)unfocus_chat[r],"1"==unfocus_is_room[r]?0!=c_chatrooms&&(changePushChannel(unfocus_chat[r],1),toggleUserChatTab(unfocus_chat[r],"1",!0,""),t=!0):receiveUser(unfocus_chat[r],uc_name[unfocus_chat[r]],uc_status[unfocus_chat[r]],uc_avatar[unfocus_chat[r]],uc_link[unfocus_chat[r]],"1");t&&receiveChatroom(),receiveCore(),displayWelcome(),a("#arrowchat_userslist_available").html('<div class="arrowchat_nofriends"><div class="arrowchat_loading_icon"></div></div>'),1==u_blist_open&&0!=c_online_list?$buddy_list_tab.click():loadBuddyList()}adjustSizes(),a(".arrowchat_powered_by").each(function(){this.style.setProperty("display","block","important")}),ion.sound({sounds:[{name:"new_message"}],volume:1,path:c_ac_path+"themes/"+u_theme+"/sounds/",preload:!0})}function playNewMessageSound(){ion.sound.play("new_message")}function renderHTMLString(t){var r=t;if(void 0!==t){var o=a("<div/>").attr("id","arrowchat_render").html(t).appendTo("body");r=a("#arrowchat_render").html(),o.remove()}return r}RegExp.escape=function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};var $base,$maintenance,$popout_chat_button,$chatrooms_button,$buddy_list_tab,$open_windows,$closed_windows,$userstab_popup,$tooltip_content,$chatrooms_popup,$unseen_users,searchxhr,typingTimeout,Y,Z,message_timeout,windowresize_timeout,push_uid,push_arrowchat,B,push,N,bounce2=1,bounce3=1,buddylisttest=1,lsreceive=0,chatroom_mod={},chatroom_admin={},count=0,V={},dtit=document.title,dtit2=1,dtit3=1,window_focus=!0,xa={},chatroom_list={},j="",$=0,w=0,bli=1,isAway=0,W=!1,E=3e3,Crref2=-1,Ccr=-1,open_report=-1,pending_msg_count=0,pending_msg_room_count=0,D=E,K=1,R=0,Ka=0,y={},G={},aa={},ca={},init_open={},init_open_room={},room_history_loaded={},last_id={},last_sent={},last_name={},history_ids={},push_room={},room_desc=[],room_limit_msg=[],room_limit_sec=[],visibleTab=[],Aa=new Date,Na=Aa.getDate(),ab=Math.floor(Aa.getTime()/1e3),acsi=1,Q=0,fa=-1,acp="Powered By <a href='http://www.arrowchat.com/' target='_blank'>ArrowChat</a>",pa=0,orig_txt_size=32,session_var="",onlineNumber=0,errorCount=0,premade_smiley=[];premade_smiley[0]=[":)","&#x1F642;"],premade_smiley[1]=[":-)","&#x1F642;"],premade_smiley[2]=["=)","&#x1F642;"],premade_smiley[3]=[":p","&#x1F61B;"],premade_smiley[4]=[":o","&#x1F62E;"],premade_smiley[5]=[":|","&#x1F610;"],premade_smiley[6]=[":(","&#x2639;&#xFE0F;"],premade_smiley[7]=["=(","&#x2639;&#xFE0F;"],premade_smiley[8]=[":D","&#x1F603;"],premade_smiley[9]=["=D","&#x1F603;"],premade_smiley[10]=[":/","&#x1F615;"],premade_smiley[11]=["=/","&#x1F615;"],premade_smiley[12]=[";)","&#x1F609;"],premade_smiley[13]=[":'(","&#x1F622;"],premade_smiley[14]=["<3","&#x2764;&#xFE0F;"],premade_smiley[15]=[">:(","&#x1F621;"],a.ajaxSetup({scriptCharset:"utf-8",cache:!1,global:!1}),a.expr[":"].icontains=function(a,t,r){return(a.textContent||a.innerText||jqac(a).text()||"").toLowerCase().indexOf(r[3].toLowerCase())>=0},arguments.callee.videoWith=function(a){if(4==c_video_select)var t=window.open("https://meet.jit.si/"+a,"audiovideochat","status=no,toolbar=no,menubar=no,directories=no,resizable=no,location=no,scrollbars=no,width="+c_video_width+",height="+c_video_height);else if(1==c_video_select)var t=window.open("https://meet.jit.si/"+a,"audiovideochat","status=no,toolbar=no,menubar=no,directories=no,resizable=no,location=no,scrollbars=no,width="+c_video_width+",height="+c_video_height);else var t=window.open(c_ac_path+"public/video/?rid="+a,"audiovideochat","status=no,toolbar=no,menubar=no,directories=no,resizable=no,location=no,scrollbars=no,width="+c_video_width+",height="+c_video_height);t.focus()},arguments.callee.runarrowchat=runarrowchat,arguments.callee.chatroom=function(a){loadChatroom(a,"")},arguments.callee.chatWith=function(a){receiveUser(a,uc_name[a],uc_status[a],uc_avatar[a],uc_link[a])},arguments.callee.getUser=function(t,r){a.ajax({url:c_ac_path+"includes/json/receive/receive_user.php",data:{userid:t},type:"post",cache:!1,dataType:"json",success:function(t){t?window[r](t):window[r](0)}})},arguments.callee.sendMessage=function(t,r){""!=r&&a.post(c_ac_path+"includes/json/send/send_message.php",{to:t,message:r},function(o){o&&(a.isNumeric(o)?addMessageToChatbox(t,r,1,1,o,1,1):a.each(o,function(r,o){"error"==r&&a.each(o,function(r,o){displayMessage(a(".arrowchat_message_box",$user_popups[t]),o.m,"error")})}),a(".arrowchat_tabcontenttext",$user_popups[t]).scrollTop(a(".arrowchat_tabcontenttext",$user_popups[t])[0].scrollHeight)),K=1})},arguments.callee.getBaseUrl=function(){return k},arguments.callee.logout=function(){clearTimeout(Z),clearTimeout(Crref2),Crref2=-1,a.idleTimer("destroy"),pushCancelAll(),cancelJSONP(),c_guests_login_msg=1,u_id="",a("#arrowchat_buddy_list_tab").remove(),$open_windows.remove(),$closed_windows.remove(),buildMaintenance()}}}(jqac),jqac(document).ready(function(){1!=u_logged_in&&1!=c_disable_arrowchat&&(jqac.arrowchat(),jqac.arrowchat.runarrowchat())});